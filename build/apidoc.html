<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="http://derbyjs.com/"

    >derby (v0.9.7)</a>
</h1>
<h4>MVC framework making it easy to write realtime, collaborative applications that run in both Node.js and browsers.</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby">module derby</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App">
            function <span class="apidocSignatureSpan">derby.</span>App
            <span class="apidocSignatureSpan">(derby, name, filename, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller">
            function <span class="apidocSignatureSpan">derby.</span>Controller
            <span class="apidocSignatureSpan">(app, page, model)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Derby">
            function <span class="apidocSignatureSpan">derby.</span>Derby
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Dom">
            function <span class="apidocSignatureSpan">derby.</span>Dom
            <span class="apidocSignatureSpan">(controller)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page">
            function <span class="apidocSignatureSpan">derby.</span>Page
            <span class="apidocSignatureSpan">(app, model, req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel">
            function <span class="apidocSignatureSpan">derby.</span>eventmodel
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.</span>App.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.</span>Controller.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.</span>Derby.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.</span>Dom.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.</span>Page.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.</span>components</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.</span>documentListeners</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.</span>eventmodel.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.</span>files</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.</span>textDiff</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.App">module derby.App</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.App">
            function <span class="apidocSignatureSpan">derby.</span>App
            <span class="apidocSignatureSpan">(derby, name, filename, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.App.prototype">module derby.App.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._addAgent">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_addAgent
            <span class="apidocSignatureSpan">(agent)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._autoRefresh">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_autoRefresh
            <span class="apidocSignatureSpan">(backend)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._contentReady">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_contentReady
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._finishInit">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_finishInit
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._getScript">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_getScript
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._handleMessage">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_handleMessage
            <span class="apidocSignatureSpan">(agent, action, message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._init">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_init
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._loadStyles">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_loadStyles
            <span class="apidocSignatureSpan">(filename, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._refreshClients">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_refreshClients
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._refreshStyles">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_refreshStyles
            <span class="apidocSignatureSpan">(filename, styles)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._updateScriptViews">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_updateScriptViews
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._viewsSource">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_viewsSource
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._watchBundle">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_watchBundle
            <span class="apidocSignatureSpan">(filenames)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._watchStyles">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_watchStyles
            <span class="apidocSignatureSpan">(filenames, filename, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype._watchViews">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>_watchViews
            <span class="apidocSignatureSpan">(filenames, filename, namespace)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.addListener">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>addListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.bundle">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>bundle
            <span class="apidocSignatureSpan">(backend, options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.component">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>component
            <span class="apidocSignatureSpan">(viewName, constructor)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.createPage">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>createPage
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.deserialize">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>deserialize
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.emit">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>emit
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.eventNames">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>eventNames
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.getMaxListeners">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>getMaxListeners
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.listenerCount">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>listenerCount
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.listeners">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>listeners
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.loadStyles">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>loadStyles
            <span class="apidocSignatureSpan">(filename, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.loadViews">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>loadViews
            <span class="apidocSignatureSpan">(filename, namespace)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.on">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>on
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.onRoute">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>onRoute
            <span class="apidocSignatureSpan">(callback, page, next, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.once">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>once
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.prependListener">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>prependListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.prependOnceListener">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>prependOnceListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.removeAllListeners">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>removeAllListeners
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.removeListener">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>removeListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.serialize">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>serialize
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.serverUse">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>serverUse
            <span class="apidocSignatureSpan">(module, id, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.setMaxListeners">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>setMaxListeners
            <span class="apidocSignatureSpan">(n)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.use">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>use
            <span class="apidocSignatureSpan">(plugin, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.App.prototype.writeScripts">
            function <span class="apidocSignatureSpan">derby.App.prototype.</span>writeScripts
            <span class="apidocSignatureSpan">(backend, dir, options, cb)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">undefined <span class="apidocSignatureSpan">derby.App.prototype.</span>domain</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.Controller">module derby.Controller</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.Controller">
            function <span class="apidocSignatureSpan">derby.</span>Controller
            <span class="apidocSignatureSpan">(app, page, model)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.Controller.prototype">module derby.Controller.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.addListener">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>addListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.emit">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>emit
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.emitCancellable">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>emitCancellable
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.emitDelayable">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>emitDelayable
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.eventNames">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>eventNames
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.getMaxListeners">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>getMaxListeners
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.listenerCount">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>listenerCount
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.listeners">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>listeners
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.on">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>on
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.once">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>once
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.prependListener">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>prependListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.prependOnceListener">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>prependOnceListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.removeAllListeners">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>removeAllListeners
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.removeListener">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>removeListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Controller.prototype.setMaxListeners">
            function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>setMaxListeners
            <span class="apidocSignatureSpan">(n)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">undefined <span class="apidocSignatureSpan">derby.Controller.prototype.</span>domain</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.Derby">module derby.Derby</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Derby.Derby">
            function <span class="apidocSignatureSpan">derby.</span>Derby
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.Derby.prototype">module derby.Derby.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Derby.prototype.App">
            function <span class="apidocSignatureSpan">derby.Derby.prototype.</span>App
            <span class="apidocSignatureSpan">(derby, name, filename, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Derby.prototype.Component">
            function <span class="apidocSignatureSpan">derby.Derby.prototype.</span>Component
            <span class="apidocSignatureSpan">(parent, context, id, scope)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Derby.prototype.Page">
            function <span class="apidocSignatureSpan">derby.Derby.prototype.</span>Page
            <span class="apidocSignatureSpan">(app, model, req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Derby.prototype.createApp">
            function <span class="apidocSignatureSpan">derby.Derby.prototype.</span>createApp
            <span class="apidocSignatureSpan">(name, filename, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Derby.prototype.run">
            function <span class="apidocSignatureSpan">derby.Derby.prototype.</span>run
            <span class="apidocSignatureSpan">(createServer)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">derby.Derby.prototype.</span>_eventsCount</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.Derby.prototype.</span>_events</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">derby.Derby.prototype.</span>domain</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.Dom">module derby.Dom</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Dom.Dom">
            function <span class="apidocSignatureSpan">derby.</span>Dom
            <span class="apidocSignatureSpan">(controller)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.Dom.prototype">module derby.Dom.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Dom.prototype._initListeners">
            function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>_initListeners
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Dom.prototype._listenerIndex">
            function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>_listenerIndex
            <span class="apidocSignatureSpan">(domListener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Dom.prototype.addListener">
            function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>addListener
            <span class="apidocSignatureSpan">(type, target, listener, useCapture)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Dom.prototype.on">
            function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>on
            <span class="apidocSignatureSpan">(type, target, listener, useCapture)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Dom.prototype.once">
            function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>once
            <span class="apidocSignatureSpan">(type, target, listener, useCapture)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Dom.prototype.removeListener">
            function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>removeListener
            <span class="apidocSignatureSpan">(type, target, listener, useCapture)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.Page">module derby.Page</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.Page">
            function <span class="apidocSignatureSpan">derby.</span>Page
            <span class="apidocSignatureSpan">(app, model, req, res)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.Page.prototype">module derby.Page.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype._addContextListeners">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_addContextListeners
            <span class="apidocSignatureSpan">(eventModel)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype._addListeners">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_addListeners
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype._addModelListeners">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_addModelListeners
            <span class="apidocSignatureSpan">(eventModel)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype._createContext">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_createContext
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype._setRenderParams">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_setRenderParams
            <span class="apidocSignatureSpan">(ns)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype._setRenderPrefix">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_setRenderPrefix
            <span class="apidocSignatureSpan">(ns)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.addListener">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>addListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.attach">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>attach
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.destroy">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>destroy
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.emit">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>emit
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.emitCancellable">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>emitCancellable
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.emitDelayable">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>emitDelayable
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.eventNames">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>eventNames
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.get">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>get
            <span class="apidocSignatureSpan">(viewName, ns, unescaped)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.getFragment">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>getFragment
            <span class="apidocSignatureSpan">(viewName, ns)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.getMaxListeners">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>getMaxListeners
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.getView">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>getView
            <span class="apidocSignatureSpan">(viewName, ns)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.listenerCount">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>listenerCount
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.listeners">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>listeners
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.on">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>on
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.once">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>once
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.prependListener">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>prependListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.prependOnceListener">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>prependOnceListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.removeAllListeners">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>removeAllListeners
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.removeListener">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>removeListener
            <span class="apidocSignatureSpan">(type, listener)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.render">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>render
            <span class="apidocSignatureSpan">(status, ns)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.renderStatic">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>renderStatic
            <span class="apidocSignatureSpan">(status, ns)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.Page.prototype.setMaxListeners">
            function <span class="apidocSignatureSpan">derby.Page.prototype.</span>setMaxListeners
            <span class="apidocSignatureSpan">(n)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">undefined <span class="apidocSignatureSpan">derby.Page.prototype.</span>domain</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.components">module derby.components</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.components.Component">
            function <span class="apidocSignatureSpan">derby.components.</span>Component
            <span class="apidocSignatureSpan">(parent, context, id, scope)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.components.ComponentFactory">
            function <span class="apidocSignatureSpan">derby.components.</span>ComponentFactory
            <span class="apidocSignatureSpan">(constructor)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.components.SingletonComponentFactory">
            function <span class="apidocSignatureSpan">derby.components.</span>SingletonComponentFactory
            <span class="apidocSignatureSpan">(constructor)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.components.createFactory">
            function <span class="apidocSignatureSpan">derby.components.</span>createFactory
            <span class="apidocSignatureSpan">(constructor)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.documentListeners">module derby.documentListeners</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.documentListeners.add">
            function <span class="apidocSignatureSpan">derby.documentListeners.</span>add
            <span class="apidocSignatureSpan">(doc)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.documentListeners.inputSupportsSelection">
            function <span class="apidocSignatureSpan">derby.documentListeners.</span>inputSupportsSelection
            <span class="apidocSignatureSpan">(input)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.eventmodel">module derby.eventmodel</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.eventmodel">
            function <span class="apidocSignatureSpan">derby.</span>eventmodel
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.eventmodel.prototype">module derby.eventmodel.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype._addBinding">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_addBinding
            <span class="apidocSignatureSpan">(binding)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype._addItemContext">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_addItemContext
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype._each">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_each
            <span class="apidocSignatureSpan">(segments, pos, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype._insert">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_insert
            <span class="apidocSignatureSpan">(index, howMany)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype._move">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_move
            <span class="apidocSignatureSpan">(from, to, howMany)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype._remove">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_remove
            <span class="apidocSignatureSpan">(index, howMany)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype._removeItemContext">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_removeItemContext
            <span class="apidocSignatureSpan">(context)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype._set">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_set
            <span class="apidocSignatureSpan">(previous, pass)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype._updateArray">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_updateArray
            <span class="apidocSignatureSpan">(from, to)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype._updateChildItemContexts">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_updateChildItemContexts
            <span class="apidocSignatureSpan">(from, to)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype._updateObject">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_updateObject
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.addBinding">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>addBinding
            <span class="apidocSignatureSpan">(segments, binding)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.addItemContext">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>addItemContext
            <span class="apidocSignatureSpan">(segments, context)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.arrayLookup">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>arrayLookup
            <span class="apidocSignatureSpan">(model, segmentsBefore, segmentsInside)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.at">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>at
            <span class="apidocSignatureSpan">(segments)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.child">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>child
            <span class="apidocSignatureSpan">(segment)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.insert">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>insert
            <span class="apidocSignatureSpan">(segments, index, howMany)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.isEmpty">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>isEmpty
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.localUpdate">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>localUpdate
            <span class="apidocSignatureSpan">(previous, pass)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.move">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>move
            <span class="apidocSignatureSpan">(segments, from, to, howMany)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.mutate">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>mutate
            <span class="apidocSignatureSpan">(segments, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.refChild">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>refChild
            <span class="apidocSignatureSpan">(ref)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.remove">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>remove
            <span class="apidocSignatureSpan">(segments, index, howMany)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.removeBinding">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>removeBinding
            <span class="apidocSignatureSpan">(binding)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.set">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>set
            <span class="apidocSignatureSpan">(segments, previous, pass)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.eventmodel.prototype.update">
            function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>update
            <span class="apidocSignatureSpan">(previous, pass)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.files">module derby.files</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.files.cssCompiler">
            function <span class="apidocSignatureSpan">derby.files.</span>cssCompiler
            <span class="apidocSignatureSpan">(file, filename, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.files.htmlCompiler">
            function <span class="apidocSignatureSpan">derby.files.</span>htmlCompiler
            <span class="apidocSignatureSpan">(file, filename)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.files.loadStylesSync">
            function <span class="apidocSignatureSpan">derby.files.</span>loadStylesSync
            <span class="apidocSignatureSpan">(app, sourceFilename, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.files.loadViewsSync">
            function <span class="apidocSignatureSpan">derby.files.</span>loadViewsSync
            <span class="apidocSignatureSpan">(app, sourceFilename, namespace)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.derby.textDiff">module derby.textDiff</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.textDiff.onStringInsert">
            function <span class="apidocSignatureSpan">derby.textDiff.</span>onStringInsert
            <span class="apidocSignatureSpan">(el, previous, index, text)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.textDiff.onStringRemove">
            function <span class="apidocSignatureSpan">derby.textDiff.</span>onStringRemove
            <span class="apidocSignatureSpan">(el, previous, index, howMany)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.derby.textDiff.onTextInput">
            function <span class="apidocSignatureSpan">derby.textDiff.</span>onTextInput
            <span class="apidocSignatureSpan">(model, segments, value)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby" id="apidoc.module.derby">module derby</a></h1>


    <h2>
        <a href="#apidoc.element.derby.App" id="apidoc.element.derby.App">
        function <span class="apidocSignatureSpan">derby.</span>App
        <span class="apidocSignatureSpan">(derby, name, filename, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function App(derby, name, filename, options) {
  EventEmitter.call(this);
  this.derby = derby;
  this.name = name;
  this.filename = filename;
  this.scriptHash = &#x27;{{DERBY_SCRIPT_HASH}}&#x27;;
  this.bundledAt = &#x27;{{DERBY_BUNDLED_AT}}&#x27;;
  this.Page = createAppPage();
  this.proto = this.Page.prototype;
  this.views = new derbyTemplates.templates.Views();
  this.tracksRoutes = tracks.setup(this);
  this.model = null;
  this.page = null;
  this._init(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller" id="apidoc.element.derby.Controller">
        function <span class="apidocSignatureSpan">derby.</span>Controller
        <span class="apidocSignatureSpan">(app, page, model)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Controller(app, page, model) {
  EventEmitter.call(this);
  this.dom = new Dom(this);
  this.app = app;
  this.page = page;
  this.model = model;
  model.data.$controller = this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Derby" id="apidoc.element.derby.Derby">
        function <span class="apidocSignatureSpan">derby.</span>Derby
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Derby() {}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Dom" id="apidoc.element.derby.Dom">
        function <span class="apidocSignatureSpan">derby.</span>Dom
        <span class="apidocSignatureSpan">(controller)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Dom(controller) {
  this.controller = controller;
  this._listeners = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page" id="apidoc.element.derby.Page">
        function <span class="apidocSignatureSpan">derby.</span>Page
        <span class="apidocSignatureSpan">(app, model, req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Page(app, model, req, res) {
  Controller.call(this, app, this, model);
  this.req = req;
  this.res = res;
  this.params = null;
  if (this.init) this.init(model);
  this.context = this._createContext();
  this._eventModel = null;
  this._removeModelListeners = null;
  this._components = {};
  this._addListeners();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
App.prototype.loadStyles = function() {};

App.prototype.createPage = function() {
if (this.page) {
  this.emit(&#x27;destroyPage&#x27;, this.page);
  this.page.destroy();
}
var page = new this.<span class="apidocCodeKeywordSpan">Page</span>(this, this.model);
this.page = page;
return page;
};

App.prototype.onRoute = function(callback, page, next, done) {
if (this._waitForAttach) {
  // Cancel any routing before the initial page attachment. Instead, do a
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel" id="apidoc.element.derby.eventmodel">
        function <span class="apidocSignatureSpan">derby.</span>eventmodel
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventModel() {
  this.id = nextId++;

  // Most of these won&#x27;t ever be filled in, so I&#x27;m just leaving them null.
  //
  // These contain our EventModel children.
  this.object = null;
  this.array = null;

  // This contains any EventModel children which have floating references.
  this.arrayByReference = null;

  // If the data stored here is ever used to lookup other values, this is an
  // object mapping remote child ID -&#x3e; ref.
  //
  // Eg given x[y], y.refOut[x.id] = &#x3c;Binding&#x3e;
  this.refOut = null;

  // This is a map from ref id -&#x3e; event model for events bound to this
  // EventModel but via a ref. We could just merge them into the main tree, but
  // this way they&#x27;re easy to move.
  //
  // Eg, given x[y] (y=1), x.1.refChildren[ref id] is an EventModel.
  this.refChildren = null;

  this.bindings = null;

  // Item contexts are contexts which need their item number changed as this
  // EventModel object moves around its surrounding list.
  this.itemContexts = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>






















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.App" id="apidoc.module.derby.App">module derby.App</a></h1>


    <h2>
        <a href="#apidoc.element.derby.App.App" id="apidoc.element.derby.App.App">
        function <span class="apidocSignatureSpan">derby.</span>App
        <span class="apidocSignatureSpan">(derby, name, filename, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function App(derby, name, filename, options) {
  EventEmitter.call(this);
  this.derby = derby;
  this.name = name;
  this.filename = filename;
  this.scriptHash = &#x27;{{DERBY_SCRIPT_HASH}}&#x27;;
  this.bundledAt = &#x27;{{DERBY_BUNDLED_AT}}&#x27;;
  this.Page = createAppPage();
  this.proto = this.Page.prototype;
  this.views = new derbyTemplates.templates.Views();
  this.tracksRoutes = tracks.setup(this);
  this.model = null;
  this.page = null;
  this._init(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.App.prototype" id="apidoc.module.derby.App.prototype">module derby.App.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.derby.App.prototype._addAgent" id="apidoc.element.derby.App.prototype._addAgent">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_addAgent
        <span class="apidocSignatureSpan">(agent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_addAgent = function (agent) {
  this.agents[agent.clientId] = agent;
  var app = this;
  agent.stream.once(&#x27;end&#x27;, function() {
    delete app.agents[agent.clientId];
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if (action === &#x27;app&#x27;) {
  if (message.name !== this.name) {
    return;
  }
  if (message.hash !== this.scriptHash) {
    return agent.send({derby: &#x27;reload&#x27;});
  }
  this.<span class="apidocCodeKeywordSpan">_addAgent</span>(agent);
}
};

App.prototype._addAgent = function(agent) {
this.agents[agent.clientId] = agent;
var app = this;
agent.stream.once(&#x27;end&#x27;, function() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._autoRefresh" id="apidoc.element.derby.App.prototype._autoRefresh">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_autoRefresh
        <span class="apidocSignatureSpan">(backend)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_autoRefresh = function (backend) {
  var agents = this.agents = {};
  var app = this;

  backend.use(&#x27;receive&#x27;, function(request, next) {
    var data = request.data;
    if (data.derby) {
      return app._handleMessage(request.agent, data.derby, data);
    }
    next();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};
App.prototype._finishInit = function() {
var script = this._getScript();
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
this.emit(&#x27;model&#x27;, this.model);
util.isProduction = data.nodeEnv === &#x27;production&#x27;;
if (!util.isProduction) this.<span class="apidocCodeKeywordSpan">_autoRefresh</span>();
this.model.unbundle(data);
var page = this.createPage();
page.params = this.model.get(&#x27;$render.params&#x27;);
this.emit(&#x27;ready&#x27;, page);
this._waitForAttach = false;
// Instead of attaching, do a route and render if a link was clicked before
// the page finished attaching
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._contentReady" id="apidoc.element.derby.App.prototype._contentReady">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_contentReady
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_contentReady = function () {
  // Is the DOM ready to be used? Set to true once it occurs.
  var isReady = false;
  var app = this;

  // The ready event handler
  function onDOMContentLoaded() {
    if (document.addEventListener) {
      document.removeEventListener(&#x27;DOMContentLoaded&#x27;, onDOMContentLoaded, false);
    } else {
      // we&#x27;re here because readyState !== &#x27;loading&#x27; in oldIE
      // which is good enough for us to call the dom ready!
      document.detachEvent(&#x27;onreadystatechange&#x27;, onDOMContentLoaded);
    }
    onDOMReady();
  }

  // Handle when the DOM is ready
  function onDOMReady() {
    // Make sure that the DOM is not already loaded
    if (isReady) return;
    // Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).
    if (!document.body) return setTimeout(onDOMReady, 0);
    // Remember that the DOM is ready
    isReady = true;
    // Make sure this is always async and then finishin init
    setTimeout(function() {
      app._finishInit();
    }, 0);
  }

  // The DOM ready check for Internet Explorer
  function doScrollCheck() {
    if (isReady) return;
    try {
      // If IE is used, use the trick by Diego Perini
      // http://javascript.nwbox.com/IEContentLoaded/
      document.documentElement.doScroll(&#x27;left&#x27;);
    } catch (err) {
      setTimeout(doScrollCheck, 0);
      return;
    }
    // and execute any waiting functions
    onDOMReady();
  }

  // Catch cases where called after the browser event has already occurred.
  if (document.readyState !== &#x27;loading&#x27;) return onDOMReady();

  // Mozilla, Opera and webkit nightlies currently support this event
  if (document.addEventListener) {
    // Use the handy event callback
    document.addEventListener(&#x27;DOMContentLoaded&#x27;, onDOMContentLoaded, false);
    // A fallback to window.onload, that will always work
    window.addEventListener(&#x27;load&#x27;, onDOMContentLoaded, false);
    // If IE event model is used
  } else if (document.attachEvent) {
    // ensure firing before onload,
    // maybe late but safe also for iframes
    document.attachEvent(&#x27;onreadystatechange&#x27;, onDOMContentLoaded);
    // A fallback to window.onload, that will always work
    window.attachEvent(&#x27;onload&#x27;, onDOMContentLoaded);
    // If IE and not a frame
    // continually check to see if the document is ready
    var toplevel;
    try {
      toplevel = window.frameElement == null;
    } catch (err) {}
    if (document.documentElement.doScroll &#x26;&#x26; toplevel) {
      doScrollCheck();
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
App.prototype._init = function() {
this._waitForAttach = true;
this._cancelAttach = false;
this.model = new this.derby.Model();
serializedViews(derbyTemplates, this.views);
// Must init async so that app.on(&#x27;model&#x27;) listeners can be added.
// Must also wait for content ready so that bundle is fully downloaded.
this.<span class="apidocCodeKeywordSpan">_contentReady</span>();
};
App.prototype._finishInit = function() {
var script = this._getScript();
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
this.emit(&#x27;model&#x27;, this.model);
util.isProduction = data.nodeEnv === &#x27;production&#x27;;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._finishInit" id="apidoc.element.derby.App.prototype._finishInit">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_finishInit
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_finishInit = function () {
  var script = this._getScript();
  var data = JSON.parse(script.nextSibling.innerHTML);
  this.model.createConnection(data);
  this.emit(&#x27;model&#x27;, this.model);
  util.isProduction = data.nodeEnv === &#x27;production&#x27;;
  if (!util.isProduction) this._autoRefresh();
  this.model.unbundle(data);
  var page = this.createPage();
  page.params = this.model.get(&#x27;$render.params&#x27;);
  this.emit(&#x27;ready&#x27;, page);
  this._waitForAttach = false;
  // Instead of attaching, do a route and render if a link was clicked before
  // the page finished attaching
  if (this._cancelAttach) {
    this.history.refresh();
    return;
  }
  // Since an attachment failure is *fatal* and could happen as a result of a
  // browser extension like AdBlock, an invalid template, or a small bug in
  // Derby or Saddle, re-render from scratch on production failures
  if (util.isProduction) {
    try {
      page.attach();
    } catch (err) {
      this.history.refresh();
      console.warn(&#x27;attachment error&#x27;, err.stack);
    }
  } else {
    page.attach();
  }
  this.emit(&#x27;load&#x27;, page);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  if (isReady) return;
  // Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).
  if (!document.body) return setTimeout(onDOMReady, 0);
  // Remember that the DOM is ready
  isReady = true;
  // Make sure this is always async and then finishin init
  setTimeout(function() {
    app.<span class="apidocCodeKeywordSpan">_finishInit</span>();
  }, 0);
}

// The DOM ready check for Internet Explorer
function doScrollCheck() {
  if (isReady) return;
  try {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._getScript" id="apidoc.element.derby.App.prototype._getScript">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_getScript
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_getScript = function () {
  return document.querySelector(&#x27;script[data-derby-app]&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.model = new this.derby.Model();
serializedViews(derbyTemplates, this.views);
// Must init async so that app.on(&#x27;model&#x27;) listeners can be added.
// Must also wait for content ready so that bundle is fully downloaded.
this._contentReady();
};
App.prototype._finishInit = function() {
var script = this.<span class="apidocCodeKeywordSpan">_getScript</span>();
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
this.emit(&#x27;model&#x27;, this.model);
util.isProduction = data.nodeEnv === &#x27;production&#x27;;
if (!util.isProduction) this._autoRefresh();
this.model.unbundle(data);
var page = this.createPage();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._handleMessage" id="apidoc.element.derby.App.prototype._handleMessage">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_handleMessage
        <span class="apidocSignatureSpan">(agent, action, message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_handleMessage = function (agent, action, message) {
  if (action === &#x27;app&#x27;) {
    if (message.name !== this.name) {
      return;
    }
    if (message.hash !== this.scriptHash) {
      return agent.send({derby: &#x27;reload&#x27;});
    }
    this._addAgent(agent);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    hash: app.scriptHash
  });
});
connection.on(&#x27;receive&#x27;, function(request) {
  if (request.data.derby) {
    var message = request.data;
    request.data = null;
    app.<span class="apidocCodeKeywordSpan">_handleMessage</span>(message.derby, message);
  }
});
};

App.prototype._handleMessage = function(action, message) {
if (action === &#x27;refreshViews&#x27;) {
  var fn = new Function(&#x27;return &#x27; + message.views)(); // jshint ignore:line
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._init" id="apidoc.element.derby.App.prototype._init">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_init
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_init = function (options) {
  this.scriptFilename = null;
  this.scriptMapFilename = null;
  this.scriptBaseUrl = (options &#x26;&#x26; options.scriptBaseUrl) || &#x27;&#x27;;
  this.scriptMapBaseUrl = (options &#x26;&#x26; options.scriptMapBaseUrl) || &#x27;&#x27;;
  this.scriptCrossOrigin = (options &#x26;&#x26; options.scriptCrossOrigin) || false;
  this.scriptUrl = null;
  this.scriptMapUrl = null;
  this.agents = null;
  this.styleExtensions = STYLE_EXTENSIONS.slice();
  this.viewExtensions = VIEW_EXTENSIONS.slice();
  this.compilers = util.copyObject(COMPILERS);

  this.serializedDir = path.dirname(this.filename || &#x27;&#x27;) + &#x27;/derby-serialized&#x27;;
  this.serializedBase = this.serializedDir + &#x27;/&#x27; + this.name;
  if (fs.existsSync(this.serializedBase + &#x27;.json&#x27;)) {
    this.deserialize();
    this.loadViews = function() {};
    this.loadStyles = function() {};
    return;
  }
  this.views.register(&#x27;Page&#x27;,
    &#x27;&#x3c;!DOCTYPE html&#x3e;&#x27; +
    &#x27;&#x3c;meta charset=&#x22;utf-8&#x22;&#x3e;&#x27; +
    &#x27;&#x3c;view is=&#x22;{{$render.prefix}}TitleElement&#x22;&#x3e;&#x3c;/view&#x3e;&#x27; +
    &#x27;&#x3c;view is=&#x22;{{$render.prefix}}Styles&#x22;&#x3e;&#x3c;/view&#x3e;&#x27; +
    &#x27;&#x3c;view is=&#x22;{{$render.prefix}}Head&#x22;&#x3e;&#x3c;/view&#x3e;&#x27; +
    &#x27;&#x3c;view is=&#x22;{{$render.prefix}}BodyElement&#x22;&#x3e;&#x3c;/view&#x3e;&#x27;,
    {serverOnly: true}
  );
  this.views.register(&#x27;TitleElement&#x27;,
    &#x27;&#x3c;title&#x3e;&#x3c;view is=&#x22;{{$render.prefix}}Title&#x22;&#x3e;&#x3c;/view&#x3e;&#x3c;/title&#x3e;&#x27;
  );
  this.views.register(&#x27;BodyElement&#x27;,
    &#x27;&#x3c;body class=&#x22;{{$bodyClass($render.ns)}}&#x22;&#x3e;&#x27; +
      &#x27;&#x3c;view is=&#x22;{{$render.prefix}}Body&#x22;&#x3e;&#x3c;/view&#x3e;&#x27;
  );
  this.views.register(&#x27;Title&#x27;, &#x27;Derby App&#x27;);
  this.views.register(&#x27;Styles&#x27;, &#x27;&#x27;, {serverOnly: true});
  this.views.register(&#x27;Head&#x27;, &#x27;&#x27;, {serverOnly: true});
  this.views.register(&#x27;Body&#x27;, &#x27;&#x27;);
  this.views.register(&#x27;Tail&#x27;, &#x27;&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.bundledAt = &#x27;{{DERBY_BUNDLED_AT}}&#x27;;
this.Page = createAppPage();
this.proto = this.Page.prototype;
this.views = new derbyTemplates.templates.Views();
this.tracksRoutes = tracks.setup(this);
this.model = null;
this.page = null;
this.<span class="apidocCodeKeywordSpan">_init</span>(options);
}

function createAppPage() {
// Inherit from Page so that we can add controller functions as prototype
// methods on this app&#x27;s pages
function AppPage() {
  Page.apply(this, arguments);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._loadStyles" id="apidoc.element.derby.App.prototype._loadStyles">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_loadStyles
        <span class="apidocSignatureSpan">(filename, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_loadStyles = function (filename, options) {
  var styles = files.loadStylesSync(this, filename, options);

  var filepath = &#x27;&#x27;;
  if (!util.isProduction) {
<span class="apidocCodeCommentSpan">    /**
     * Mark the path to file as an attribute
     * Used in development to add event watchers and autorefreshing of styles
     * SEE: local file, method this._watchStyles
     * SEE: file ./App.js, method App._autoRefresh()
     */
</span>    filepath = &#x27; data-filename=&#x22;&#x27; + filename + &#x27;&#x22;&#x27;;
  }
  var source = &#x27;&#x3c;style&#x27; + filepath + &#x27;&#x3e;&#x27; + styles.css + &#x27;&#x3c;/style&#x3e;&#x27;;

  this.views.register(filename, source, {
    serverOnly: true
  });

  if (!util.isProduction) {
    this._watchStyles(styles.files, filename, options);
  }

  return styles;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  }
  if (!util.isProduction) this._watchViews(data.files, filename, namespace);
  // Make chainable
  return this;
};

App.prototype.loadStyles = function(filename, options) {
  this.<span class="apidocCodeKeywordSpan">_loadStyles</span>(filename, options);
  var stylesView = this.views.find(&#x27;Styles&#x27;);
  stylesView.source += &#x27;&#x3c;view is=&#x22;&#x27; + filename + &#x27;&#x22;&#x3e;&#x3c;/view&#x3e;&#x27;;
  // Make chainable
  return this;
};

App.prototype._loadStyles = function(filename, options) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._refreshClients" id="apidoc.element.derby.App.prototype._refreshClients">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_refreshClients
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_refreshClients = function () {
  if (!this.agents) return;
  var views = this.views.serialize({minify: true});
  var message = {
    derby: &#x27;refreshViews&#x27;,
    views: views
  };
  for (var id in this.agents) {
    this.agents[id].send(message);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
App.prototype._watchViews = function(filenames, filename, namespace) {
var app = this;
var watcher = chokidar.watch(filenames);
watcher.on(&#x27;change&#x27;, function() {
  watcher.close();
  app.loadViews(filename, namespace);
  app._updateScriptViews();
  app.<span class="apidocCodeKeywordSpan">_refreshClients</span>();
});
};

App.prototype._watchStyles = function(filenames, filename, options) {
var app = this;
var watcher = chokidar.watch(filenames);
watcher.on(&#x27;change&#x27;, function() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._refreshStyles" id="apidoc.element.derby.App.prototype._refreshStyles">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_refreshStyles
        <span class="apidocSignatureSpan">(filename, styles)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_refreshStyles = function (filename, styles) {
  if (!this.agents) return;
  var data = {filename: filename, css: styles.css};
  var message = {
    derby: &#x27;refreshStyles&#x27;,
    filename: filename,
    css: styles.css
  };
  for (var id in this.agents) {
    this.agents[id].send(message);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
App.prototype._watchStyles = function(filenames, filename, options) {
var app = this;
var watcher = chokidar.watch(filenames);
watcher.on(&#x27;change&#x27;, function() {
  watcher.close();
  var styles = app._loadStyles(filename, options);
  app._updateScriptViews();
  app.<span class="apidocCodeKeywordSpan">_refreshStyles</span>(filename, styles);
});
};

App.prototype._watchBundle = function(filenames) {
if (!process.send) return;
var app = this;
var watcher = chokidar.watch(filenames);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._updateScriptViews" id="apidoc.element.derby.App.prototype._updateScriptViews">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_updateScriptViews
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_updateScriptViews = function () {
  if (!this.scriptFilename) return;
  var script = fs.readFileSync(this.scriptFilename, &#x27;utf8&#x27;);
  var i = script.indexOf(&#x27;/*DERBY_SERIALIZED_VIEWS*/&#x27;);
  var before = script.slice(0, i);
  var i = script.indexOf(&#x27;/*DERBY_SERIALIZED_VIEWS_END*/&#x27;);
  var after = script.slice(i + 30);
  var viewsSource = this._viewsSource();
  fs.writeFileSync(this.scriptFilename, before + viewsSource + after, &#x27;utf8&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

App.prototype._watchViews = function(filenames, filename, namespace) {
var app = this;
var watcher = chokidar.watch(filenames);
watcher.on(&#x27;change&#x27;, function() {
  watcher.close();
  app.loadViews(filename, namespace);
  app.<span class="apidocCodeKeywordSpan">_updateScriptViews</span>();
  app._refreshClients();
});
};

App.prototype._watchStyles = function(filenames, filename, options) {
var app = this;
var watcher = chokidar.watch(filenames);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._viewsSource" id="apidoc.element.derby.App.prototype._viewsSource">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_viewsSource
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_viewsSource = function (options) {
  return &#x27;/*DERBY_SERIALIZED_VIEWS*/&#x27; +
    &#x27;module.exports = &#x27; + this.views.serialize(options) + &#x27;;&#x27; +
    &#x27;/*DERBY_SERIALIZED_VIEWS_END*/&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  cb = options;
  options = null;
}
options || (options = {});
if (options.minify == null) options.minify = util.isProduction;
// Turn all of the app&#x27;s currently registered views into a javascript
// function that can recreate them in the client
var viewsSource = this.<span class="apidocCodeKeywordSpan">_viewsSource</span>(options);
var bundleFiles = [];
backend.once(&#x27;bundle&#x27;, function(bundle) {
  bundle.require(path.dirname(__dirname), {expose: &#x27;derby&#x27;});
  // Hack to inject the views script into the Browserify bundle by replacing
  // the empty _views.js file with the generated source
  var viewsFilename = require.resolve(&#x27;./_views&#x27;);
  bundle.transform(function(filename) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._watchBundle" id="apidoc.element.derby.App.prototype._watchBundle">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_watchBundle
        <span class="apidocSignatureSpan">(filenames)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_watchBundle = function (filenames) {
  if (!process.send) return;
  var app = this;
  var watcher = chokidar.watch(filenames);
  watcher.on(&#x27;change&#x27;, function() {
    watcher.close();
    process.send({type: &#x27;reload&#x27;});
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
backend.bundle(app.filename, options, function(err, source, map) {
  if (err) return cb(err);
  app.scriptHash = crypto.createHash(&#x27;md5&#x27;).update(source).digest(&#x27;hex&#x27;);
  source = source.replace(&#x27;{{DERBY_SCRIPT_HASH}}&#x27;, app.scriptHash);
  source = source.replace(/[&#x27;&#x22;]{{DERBY_BUNDLED_AT}}[&#x27;&#x22;]/, Date.now());
  if (!util.isProduction) {
    app._autoRefresh(backend);
    app.<span class="apidocCodeKeywordSpan">_watchBundle</span>(bundleFiles);
  }
  cb(null, source, map);
});
};

App.prototype.writeScripts = function(backend, dir, options, cb) {
var app = this;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._watchStyles" id="apidoc.element.derby.App.prototype._watchStyles">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_watchStyles
        <span class="apidocSignatureSpan">(filenames, filename, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_watchStyles = function (filenames, filename, options) {
  var app = this;
  var watcher = chokidar.watch(filenames);
  watcher.on(&#x27;change&#x27;, function() {
    watcher.close();
    var styles = app._loadStyles(filename, options);
    app._updateScriptViews();
    app._refreshStyles(filename, styles);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var source = &#x27;&#x3c;style&#x27; + filepath + &#x27;&#x3e;&#x27; + styles.css + &#x27;&#x3c;/style&#x3e;&#x27;;

this.views.register(filename, source, {
  serverOnly: true
});

if (!util.isProduction) {
  this.<span class="apidocCodeKeywordSpan">_watchStyles</span>(styles.files, filename, options);
}

return styles;
};

App.prototype._watchViews = function(filenames, filename, namespace) {
var app = this;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype._watchViews" id="apidoc.element.derby.App.prototype._watchViews">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>_watchViews
        <span class="apidocSignatureSpan">(filenames, filename, namespace)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_watchViews = function (filenames, filename, namespace) {
  var app = this;
  var watcher = chokidar.watch(filenames);
  watcher.on(&#x27;change&#x27;, function() {
    watcher.close();
    app.loadViews(filename, namespace);
    app._updateScriptViews();
    app._refreshClients();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

App.prototype.loadViews = function(filename, namespace) {
var data = files.loadViewsSync(this, filename, namespace);
for (var i = 0, len = data.views.length; i &#x3c; len; i++) {
  var item = data.views[i];
  this.views.register(item.name, item.source, item.options);
}
if (!util.isProduction) this.<span class="apidocCodeKeywordSpan">_watchViews</span>(data.files, filename, namespace);
// Make chainable
return this;
};

App.prototype.loadStyles = function(filename, options) {
this._loadStyles(filename, options);
var stylesView = this.views.find(&#x27;Styles&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.addListener" id="apidoc.element.derby.App.prototype.addListener">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>addListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addListener(type, listener) {
  return _addListener(this, type, listener, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Dom.prototype.once = function(type, target, listener, useCapture) {
  if (typeof target === &#x27;function&#x27;) {
    useCapture = listener;
    listener = target;
    target = document;
  }
  this.<span class="apidocCodeKeywordSpan">addListener</span>(type, target, wrappedListener, useCapture);
  var dom = this;
  function wrappedListener() {
    dom.removeListener(type, target, wrappedListener, useCapture);
    return listener.apply(this, arguments);
  }
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.bundle" id="apidoc.element.derby.App.prototype.bundle">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>bundle
        <span class="apidocSignatureSpan">(backend, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">bundle = function (backend, options, cb) {
  var app = this;
  if (typeof options === &#x27;function&#x27;) {
    cb = options;
    options = null;
  }
  options || (options = {});
  if (options.minify == null) options.minify = util.isProduction;
  // Turn all of the app&#x27;s currently registered views into a javascript
  // function that can recreate them in the client
  var viewsSource = this._viewsSource(options);
  var bundleFiles = [];
  backend.once(&#x27;bundle&#x27;, function(bundle) {
    bundle.require(path.dirname(__dirname), {expose: &#x27;derby&#x27;});
    // Hack to inject the views script into the Browserify bundle by replacing
    // the empty _views.js file with the generated source
    var viewsFilename = require.resolve(&#x27;./_views&#x27;);
    bundle.transform(function(filename) {
      if (filename !== viewsFilename) return through();
      return through(
        function write() {}
      , function end() {
          this.queue(viewsSource);
          this.queue(null);
        }
      );
    }, {global: true});
    bundle.on(&#x27;file&#x27;, function(filename) {
      bundleFiles.push(filename);
    });
    app.emit(&#x27;bundle&#x27;, bundle);
  });
  backend.bundle(app.filename, options, function(err, source, map) {
    if (err) return cb(err);
    app.scriptHash = crypto.createHash(&#x27;md5&#x27;).update(source).digest(&#x27;hex&#x27;);
    source = source.replace(&#x27;{{DERBY_SCRIPT_HASH}}&#x27;, app.scriptHash);
    source = source.replace(/[&#x27;&#x22;]{{DERBY_BUNDLED_AT}}[&#x27;&#x22;]/, Date.now());
    if (!util.isProduction) {
      app._autoRefresh(backend);
      app._watchBundle(bundleFiles);
    }
    cb(null, source, map);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    );
  }, {global: true});
  bundle.on(&#x27;file&#x27;, function(filename) {
    bundleFiles.push(filename);
  });
  app.emit(&#x27;bundle&#x27;, bundle);
});
backend.<span class="apidocCodeKeywordSpan">bundle</span>(app.filename, options, function(err, source, map) {
  if (err) return cb(err);
  app.scriptHash = crypto.createHash(&#x27;md5&#x27;).update(source).digest(&#x27;hex&#x27;);
  source = source.replace(&#x27;{{DERBY_SCRIPT_HASH}}&#x27;, app.scriptHash);
  source = source.replace(/[&#x27;&#x22;]{{DERBY_BUNDLED_AT}}[&#x27;&#x22;]/, Date.now());
  if (!util.isProduction) {
    app._autoRefresh(backend);
    app._watchBundle(bundleFiles);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.component" id="apidoc.element.derby.App.prototype.component">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>component
        <span class="apidocSignatureSpan">(viewName, constructor)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">component = function (viewName, constructor) {
  if (typeof viewName === &#x27;function&#x27;) {
    constructor = viewName;
    viewName = null;
  }

  // Inherit from Component
  extendComponent(constructor);

  // Load template view from filename
  if (constructor.prototype.view) {
    var viewFilename = constructor.prototype.view;
    viewName = constructor.prototype.name || path.basename(viewFilename, &#x27;.html&#x27;);
    this.loadViews(viewFilename, viewName);

  } else if (!viewName) {
    if (constructor.prototype.name) {
      viewName = constructor.prototype.name;
      var view = this.views.register(viewName);
      view.template = templates.emptyTemplate;
    } else {
      throw new Error(&#x27;No view name specified for component&#x27;);
    }
  }

  // Associate the appropriate view with the component type
  var view = this.views.find(viewName);
  if (!view) {
    var message = this.views.findErrorMessage(viewName);
    throw new Error(message);
  }
  view.componentFactory = createFactory(constructor);

  // Make chainable
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.createPage" id="apidoc.element.derby.App.prototype.createPage">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>createPage
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createPage = function (req, res, next) {
  var model = req.model || new racer.Model();
  this.emit(&#x27;model&#x27;, model);
  var page = new this.Page(this, model, req, res);
  if (next) {
    model.on(&#x27;error&#x27;, function(err){
      model.hasErrored = true;
      next(err);
    });
    page.on(&#x27;error&#x27;, next);
  }
  return page;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var script = this._getScript();
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
this.emit(&#x27;model&#x27;, this.model);
util.isProduction = data.nodeEnv === &#x27;production&#x27;;
if (!util.isProduction) this._autoRefresh();
this.model.unbundle(data);
var page = this.<span class="apidocCodeKeywordSpan">createPage</span>();
page.params = this.model.get(&#x27;$render.params&#x27;);
this.emit(&#x27;ready&#x27;, page);
this._waitForAttach = false;
// Instead of attaching, do a route and render if a link was clicked before
// the page finished attaching
if (this._cancelAttach) {
  this.history.refresh();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.deserialize" id="apidoc.element.derby.App.prototype.deserialize">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>deserialize
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">deserialize = function () {
  var serializedViews = require(this.serializedBase + &#x27;.views.js&#x27;);
  var serialized = require(this.serializedBase + &#x27;.json&#x27;);
  serializedViews(derbyTemplates, this.views);
  this.scriptUrl = (this.scriptBaseUrl || serialized.scriptBaseUrl) + serialized.scriptUrl;
  this.scriptMapUrl = (this.scriptMapBaseUrl || serialized.scriptMapBaseUrl) + serialized.scriptMapUrl;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.styleExtensions = STYLE_EXTENSIONS.slice();
this.viewExtensions = VIEW_EXTENSIONS.slice();
this.compilers = util.copyObject(COMPILERS);

this.serializedDir = path.dirname(this.filename || &#x27;&#x27;) + &#x27;/derby-serialized&#x27;;
this.serializedBase = this.serializedDir + &#x27;/&#x27; + this.name;
if (fs.existsSync(this.serializedBase + &#x27;.json&#x27;)) {
  this.<span class="apidocCodeKeywordSpan">deserialize</span>();
  this.loadViews = function() {};
  this.loadStyles = function() {};
  return;
}
this.views.register(&#x27;Page&#x27;,
  &#x27;&#x3c;!DOCTYPE html&#x3e;&#x27; +
  &#x27;&#x3c;meta charset=&#x22;utf-8&#x22;&#x3e;&#x27; +
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.emit" id="apidoc.element.derby.App.prototype.emit">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>emit
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function emit(type) {
  var er, handler, len, args, i, events, domain;
  var needDomainExit = false;
  var doError = (type === &#x27;error&#x27;);

  events = this._events;
  if (events)
    doError = (doError &#x26;&#x26; events.error == null);
  else if (!doError)
    return false;

  domain = this.domain;

  // If there is no &#x27;error&#x27; event listener then throw.
  if (doError) {
    er = arguments[1];
    if (domain) {
      if (!er)
        er = new Error(&#x27;Uncaught, unspecified &#x22;error&#x22; event&#x27;);
      er.domainEmitter = this;
      er.domain = domain;
      er.domainThrown = false;
      domain.emit(&#x27;error&#x27;, er);
    } else if (er instanceof Error) {
      throw er; // Unhandled &#x27;error&#x27; event
    } else {
      // At least give some kind of context to the user
      var err = new Error(&#x27;Uncaught, unspecified &#x22;error&#x22; event. (&#x27; + er + &#x27;)&#x27;);
      err.context = er;
      throw err;
    }
    return false;
  }

  handler = events[type];

  if (!handler)
    return false;

  if (domain &#x26;&#x26; this !== process) {
    domain.enter();
    needDomainExit = true;
  }

  var isFn = typeof handler === &#x27;function&#x27;;
  len = arguments.length;
  switch (len) {
    // fast cases
    case 1:
      emitNone(handler, isFn, this);
      break;
    case 2:
      emitOne(handler, isFn, this, arguments[1]);
      break;
    case 3:
      emitTwo(handler, isFn, this, arguments[1], arguments[2]);
      break;
    case 4:
      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);
      break;
    // slower
    default:
      args = new Array(len - 1);
      for (i = 1; i &#x3c; len; i++)
        args[i - 1] = arguments[i];
      emitMany(handler, isFn, this, args);
  }

  if (needDomainExit)
    domain.exit();

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// Must also wait for content ready so that bundle is fully downloaded.
this._contentReady();
};
App.prototype._finishInit = function() {
var script = this._getScript();
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
this.<span class="apidocCodeKeywordSpan">emit</span>(&#x27;model&#x27;, this.model);
util.isProduction = data.nodeEnv === &#x27;production&#x27;;
if (!util.isProduction) this._autoRefresh();
this.model.unbundle(data);
var page = this.createPage();
page.params = this.model.get(&#x27;$render.params&#x27;);
this.emit(&#x27;ready&#x27;, page);
this._waitForAttach = false;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.eventNames" id="apidoc.element.derby.App.prototype.eventNames">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>eventNames
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function eventNames() {
  return this._eventsCount &#x3e; 0 ? Reflect.ownKeys(this._events) : [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.getMaxListeners" id="apidoc.element.derby.App.prototype.getMaxListeners">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>getMaxListeners
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMaxListeners() {
  return $getMaxListeners(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.listenerCount" id="apidoc.element.derby.App.prototype.listenerCount">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>listenerCount
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function listenerCount(type) {
  const events = this._events;

  if (events) {
    const evlistener = events[type];

    if (typeof evlistener === &#x27;function&#x27;) {
      return 1;
    } else if (evlistener) {
      return evlistener.length;
    }
  }

  return 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.listeners" id="apidoc.element.derby.App.prototype.listeners">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>listeners
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function listeners(type) {
  var evlistener;
  var ret;
  var events = this._events;

  if (!events)
    ret = [];
  else {
    evlistener = events[type];
    if (!evlistener)
      ret = [];
    else if (typeof evlistener === &#x27;function&#x27;)
      ret = [evlistener];
    else
      ret = arrayClone(evlistener, evlistener.length);
  }

  return ret;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.loadStyles" id="apidoc.element.derby.App.prototype.loadStyles">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>loadStyles
        <span class="apidocSignatureSpan">(filename, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadStyles = function (filename, options) {
  this._loadStyles(filename, options);
  var stylesView = this.views.find(&#x27;Styles&#x27;);
  stylesView.source += &#x27;&#x3c;view is=&#x22;&#x27; + filename + &#x27;&#x22;&#x3e;&#x3c;/view&#x3e;&#x27;;
  // Make chainable
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.loadViews" id="apidoc.element.derby.App.prototype.loadViews">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>loadViews
        <span class="apidocSignatureSpan">(filename, namespace)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">loadViews = function (filename, namespace) {
  var data = files.loadViewsSync(this, filename, namespace);
  for (var i = 0, len = data.views.length; i &#x3c; len; i++) {
    var item = data.views[i];
    this.views.register(item.name, item.source, item.options);
  }
  if (!util.isProduction) this._watchViews(data.files, filename, namespace);
  // Make chainable
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

App.prototype._watchViews = function(filenames, filename, namespace) {
var app = this;
var watcher = chokidar.watch(filenames);
watcher.on(&#x27;change&#x27;, function() {
  watcher.close();
  app.<span class="apidocCodeKeywordSpan">loadViews</span>(filename, namespace);
  app._updateScriptViews();
  app._refreshClients();
});
};

App.prototype._watchStyles = function(filenames, filename, options) {
var app = this;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.on" id="apidoc.element.derby.App.prototype.on">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>on
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addListener(type, listener) {
  return _addListener(this, type, listener, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Overriden on server
App.prototype._init = function() {
this._waitForAttach = true;
this._cancelAttach = false;
this.model = new this.derby.Model();
serializedViews(derbyTemplates, this.views);
// Must init async so that app.<span class="apidocCodeKeywordSpan">on</span>(&#x27;model&#x27;) listeners can be added.
// Must also wait for content ready so that bundle is fully downloaded.
this._contentReady();
};
App.prototype._finishInit = function() {
var script = this._getScript();
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.onRoute" id="apidoc.element.derby.App.prototype.onRoute">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>onRoute
        <span class="apidocSignatureSpan">(callback, page, next, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onRoute = function (callback, page, next, done) {
  if (this._waitForAttach) {
    // Cancel any routing before the initial page attachment. Instead, do a
    // render once derby is ready
    this._cancelAttach = true;
    return;
  }
  this.emit(&#x27;route&#x27;, page);
  // HACK: To update render in transitional routes
  page.model.set(&#x27;$render.params&#x27;, page.params);
  page.model.set(&#x27;$render.url&#x27;, page.params.url);
  page.model.set(&#x27;$render.query&#x27;, page.params.query);
  // If transitional
  if (done) {
    var app = this;
    var _done = function() {
      app.emit(&#x27;routeDone&#x27;, page, &#x27;transition&#x27;);
      done();
    };
    callback.call(page, page, page.model, page.params, next, _done);
    return;
  }
  callback.call(page, page, page.model, page.params, next);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.once" id="apidoc.element.derby.App.prototype.once">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>once
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function once(type, listener) {
  if (typeof listener !== &#x27;function&#x27;)
    throw new TypeError(&#x27;&#x22;listener&#x22; argument must be a function&#x27;);
  this.on(type, _onceWrap(this, type, listener));
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
options || (options = {});
if (options.minify == null) options.minify = util.isProduction;
// Turn all of the app&#x27;s currently registered views into a javascript
// function that can recreate them in the client
var viewsSource = this._viewsSource(options);
var bundleFiles = [];
backend.<span class="apidocCodeKeywordSpan">once</span>(&#x27;bundle&#x27;, function(bundle) {
  bundle.require(path.dirname(__dirname), {expose: &#x27;derby&#x27;});
  // Hack to inject the views script into the Browserify bundle by replacing
  // the empty _views.js file with the generated source
  var viewsFilename = require.resolve(&#x27;./_views&#x27;);
  bundle.transform(function(filename) {
    if (filename !== viewsFilename) return through();
    return through(
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.prependListener" id="apidoc.element.derby.App.prototype.prependListener">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>prependListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function prependListener(type, listener) {
  return _addListener(this, type, listener, true);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.prependOnceListener" id="apidoc.element.derby.App.prototype.prependOnceListener">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>prependOnceListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function prependOnceListener(type, listener) {
  if (typeof listener !== &#x27;function&#x27;)
    throw new TypeError(&#x27;&#x22;listener&#x22; argument must be a function&#x27;);
  this.prependListener(type, _onceWrap(this, type, listener));
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.removeAllListeners" id="apidoc.element.derby.App.prototype.removeAllListeners">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>removeAllListeners
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function removeAllListeners(type) {
  var listeners, events;

  events = this._events;
  if (!events)
    return this;

  // not listening for removeListener, no need to emit
  if (!events.removeListener) {
    if (arguments.length === 0) {
      this._events = new EventHandlers();
      this._eventsCount = 0;
    } else if (events[type]) {
      if (--this._eventsCount === 0)
        this._events = new EventHandlers();
      else
        delete events[type];
    }
    return this;
  }

  // emit removeListener for all listeners on all events
  if (arguments.length === 0) {
    var keys = Object.keys(events);
    for (var i = 0, key; i &#x3c; keys.length; ++i) {
      key = keys[i];
      if (key === &#x27;removeListener&#x27;) continue;
      this.removeAllListeners(key);
    }
    this.removeAllListeners(&#x27;removeListener&#x27;);
    this._events = new EventHandlers();
    this._eventsCount = 0;
    return this;
  }

  listeners = events[type];

  if (typeof listeners === &#x27;function&#x27;) {
    this.removeListener(type, listeners);
  } else if (listeners) {
    // LIFO order
    do {
      this.removeListener(type, listeners[listeners.length - 1]);
    } while (listeners[0]);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.removeListener" id="apidoc.element.derby.App.prototype.removeListener">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>removeListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function removeListener(type, listener) {
  var list, events, position, i, originalListener;

  if (typeof listener !== &#x27;function&#x27;)
    throw new TypeError(&#x27;&#x22;listener&#x22; argument must be a function&#x27;);

  events = this._events;
  if (!events)
    return this;

  list = events[type];
  if (!list)
    return this;

  if (list === listener || list.listener === listener) {
    if (--this._eventsCount === 0)
      this._events = new EventHandlers();
    else {
      delete events[type];
      if (events.removeListener)
        this.emit(&#x27;removeListener&#x27;, type, list.listener || listener);
    }
  } else if (typeof list !== &#x27;function&#x27;) {
    position = -1;

    for (i = list.length; i-- &#x3e; 0;) {
      if (list[i] === listener || list[i].listener === listener) {
        originalListener = list[i].listener;
        position = i;
        break;
      }
    }

    if (position &#x3c; 0)
      return this;

    if (list.length === 1) {
      list[0] = undefined;
      if (--this._eventsCount === 0) {
        this._events = new EventHandlers();
        return this;
      } else {
        delete events[type];
      }
    } else {
      spliceOne(list, position);
    }

    if (events.removeListener)
      this.emit(&#x27;removeListener&#x27;, type, originalListener || listener);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  useCapture = listener;
  listener = target;
  target = document;
}
this.addListener(type, target, wrappedListener, useCapture);
var dom = this;
function wrappedListener() {
  dom.<span class="apidocCodeKeywordSpan">removeListener</span>(type, target, wrappedListener, useCapture);
  return listener.apply(this, arguments);
}
};

Dom.prototype.removeListener = function(type, target, listener, useCapture) {
if (typeof target === &#x27;function&#x27;) {
  useCapture = listener;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.serialize" id="apidoc.element.derby.App.prototype.serialize">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>serialize
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serialize = function () {
  if (!fs.existsSync(this.serializedDir)) {
    fs.mkdirSync(this.serializedDir);
  }
  // Don&#x27;t minify the views (which doesn&#x27;t include template source), since this
  // is for use on the server
  var viewsSource = this._viewsSource({server: true, minify: true});
  fs.writeFileSync(this.serializedBase + &#x27;.views.js&#x27;, viewsSource, &#x27;utf8&#x27;);
  var scriptUrl = (this.scriptUrl.indexOf(this.scriptBaseUrl) === 0) ?
    this.scriptUrl.slice(this.scriptBaseUrl.length) :
    this.scriptUrl;
  var scriptMapUrl = (this.scriptMapUrl.indexOf(this.scriptMapBaseUrl) === 0) ?
    this.scriptMapUrl.slice(this.scriptMapBaseUrl.length) :
    this.scriptMapUrl;
  var serialized = JSON.stringify({
    scriptBaseUrl: this.scriptBaseUrl
  , scriptMapBaseUrl: this.scriptMapBaseUrl
  , scriptUrl: scriptUrl
  , scriptMapUrl: scriptMapUrl
  });
  fs.writeFileSync(this.serializedBase + &#x27;.json&#x27;, serialized, &#x27;utf8&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  }
  cb &#x26;&#x26; cb();
});
};

App.prototype._viewsSource = function(options) {
return &#x27;/*DERBY_SERIALIZED_VIEWS*/&#x27; +
  &#x27;module.exports = &#x27; + this.views.<span class="apidocCodeKeywordSpan">serialize</span>(options) + &#x27;;&#x27; +
  &#x27;/*DERBY_SERIALIZED_VIEWS_END*/&#x27;;
};

App.prototype.serialize = function() {
if (!fs.existsSync(this.serializedDir)) {
  fs.mkdirSync(this.serializedDir);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.serverUse" id="apidoc.element.derby.App.prototype.serverUse">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>serverUse
        <span class="apidocSignatureSpan">(module, id, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function serverUse(module, id, options) {
  if (!isServer) return this;
  var plugin = module.require(id);
  return this.use(plugin, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.setMaxListeners" id="apidoc.element.derby.App.prototype.setMaxListeners">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>setMaxListeners
        <span class="apidocSignatureSpan">(n)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setMaxListeners(n) {
  if (typeof n !== &#x27;number&#x27; || n &#x3c; 0 || isNaN(n))
    throw new TypeError(&#x27;&#x22;n&#x22; argument must be a positive number&#x27;);
  this._maxListeners = n;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.use" id="apidoc.element.derby.App.prototype.use">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>use
        <span class="apidocSignatureSpan">(plugin, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function use(plugin, options) {
  // Don&#x27;t include a plugin more than once
  var plugins = this._plugins || (this._plugins = []);
  if (plugins.indexOf(plugin) === -1) {
    plugins.push(plugin);
    plugin(this, options);
  }
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  fs.writeFileSync(this.scriptFilename, before + viewsSource + after, &#x27;utf8&#x27;);
};

App.prototype._autoRefresh = function(backend) {
  var agents = this.agents = {};
  var app = this;

  backend.<span class="apidocCodeKeywordSpan">use</span>(&#x27;receive&#x27;, function(request, next) {
    var data = request.data;
    if (data.derby) {
      return app._handleMessage(request.agent, data.derby, data);
    }
    next();
  });
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.App.prototype.writeScripts" id="apidoc.element.derby.App.prototype.writeScripts">
        function <span class="apidocSignatureSpan">derby.App.prototype.</span>writeScripts
        <span class="apidocSignatureSpan">(backend, dir, options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">writeScripts = function (backend, dir, options, cb) {
  var app = this;
  this.bundle(backend, options, function(err, source, map) {
    if (err) return cb(err);
    dir = path.join(dir, &#x27;derby&#x27;);
    if (!fs.existsSync(dir)) fs.mkdirSync(dir);
    var filename = app.name + &#x27;-&#x27; + app.scriptHash;
    var base = path.join(dir, filename);
    app.scriptUrl = app.scriptBaseUrl + &#x27;/derby/&#x27; + filename + &#x27;.js&#x27;;

    // Write current map and bundle files
    if (!(options &#x26;&#x26; options.disableScriptMap)) {
      app.scriptMapUrl = app.scriptMapBaseUrl +  &#x27;/derby/&#x27; + filename + &#x27;.map.json&#x27;;
      source += &#x27;\n//# sourceMappingURL=&#x27; + app.scriptMapUrl;
      app.scriptMapFilename = base + &#x27;.map.json&#x27;;
      fs.writeFileSync(app.scriptMapFilename, map, &#x27;utf8&#x27;);
    }
    app.scriptFilename = base + &#x27;.js&#x27;;
    fs.writeFileSync(app.scriptFilename, source, &#x27;utf8&#x27;);

    // Delete app bundles with same name in development so files don&#x27;t
    // accumulate. Don&#x27;t do this automatically in production, since there could
    // be race conditions with multiple processes intentionally running
    // different versions of the app in parallel out of the same directory,
    // such as during a rolling restart.
    if (!util.isProduction) {
      var appPrefix = app.name + &#x27;-&#x27;;
      var currentBundlePrefix = appPrefix + app.scriptHash;
      var filenames = fs.readdirSync(dir);
      for (var i = 0; i &#x3c; filenames.length; i++) {
        var filename = filenames[i];
        if (filename.indexOf(appPrefix) !== 0) {
          // Not a bundle for this app, skip.
          continue;
        }
        if (filename.indexOf(currentBundlePrefix) === 0) {
          // Current (newly written) bundle for this app, skip.
          continue;
        }
        // Older bundle for this app, clean it up.
        var oldFilename = path.join(dir, filename);
        fs.unlinkSync(oldFilename);
      }
    }
    cb &#x26;&#x26; cb();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.Controller" id="apidoc.module.derby.Controller">module derby.Controller</a></h1>


    <h2>
        <a href="#apidoc.element.derby.Controller.Controller" id="apidoc.element.derby.Controller.Controller">
        function <span class="apidocSignatureSpan">derby.</span>Controller
        <span class="apidocSignatureSpan">(app, page, model)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Controller(app, page, model) {
  EventEmitter.call(this);
  this.dom = new Dom(this);
  this.app = app;
  this.page = page;
  this.model = model;
  model.data.$controller = this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.Controller.prototype" id="apidoc.module.derby.Controller.prototype">module derby.Controller.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.addListener" id="apidoc.element.derby.Controller.prototype.addListener">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>addListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addListener(type, listener) {
  return _addListener(this, type, listener, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Dom.prototype.once = function(type, target, listener, useCapture) {
  if (typeof target === &#x27;function&#x27;) {
    useCapture = listener;
    listener = target;
    target = document;
  }
  this.<span class="apidocCodeKeywordSpan">addListener</span>(type, target, wrappedListener, useCapture);
  var dom = this;
  function wrappedListener() {
    dom.removeListener(type, target, wrappedListener, useCapture);
    return listener.apply(this, arguments);
  }
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.emit" id="apidoc.element.derby.Controller.prototype.emit">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>emit
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function emit(type) {
  var er, handler, len, args, i, events, domain;
  var needDomainExit = false;
  var doError = (type === &#x27;error&#x27;);

  events = this._events;
  if (events)
    doError = (doError &#x26;&#x26; events.error == null);
  else if (!doError)
    return false;

  domain = this.domain;

  // If there is no &#x27;error&#x27; event listener then throw.
  if (doError) {
    er = arguments[1];
    if (domain) {
      if (!er)
        er = new Error(&#x27;Uncaught, unspecified &#x22;error&#x22; event&#x27;);
      er.domainEmitter = this;
      er.domain = domain;
      er.domainThrown = false;
      domain.emit(&#x27;error&#x27;, er);
    } else if (er instanceof Error) {
      throw er; // Unhandled &#x27;error&#x27; event
    } else {
      // At least give some kind of context to the user
      var err = new Error(&#x27;Uncaught, unspecified &#x22;error&#x22; event. (&#x27; + er + &#x27;)&#x27;);
      err.context = er;
      throw err;
    }
    return false;
  }

  handler = events[type];

  if (!handler)
    return false;

  if (domain &#x26;&#x26; this !== process) {
    domain.enter();
    needDomainExit = true;
  }

  var isFn = typeof handler === &#x27;function&#x27;;
  len = arguments.length;
  switch (len) {
    // fast cases
    case 1:
      emitNone(handler, isFn, this);
      break;
    case 2:
      emitOne(handler, isFn, this, arguments[1]);
      break;
    case 3:
      emitTwo(handler, isFn, this, arguments[1], arguments[2]);
      break;
    case 4:
      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);
      break;
    // slower
    default:
      args = new Array(len - 1);
      for (i = 1; i &#x3c; len; i++)
        args[i - 1] = arguments[i];
      emitMany(handler, isFn, this, args);
  }

  if (needDomainExit)
    domain.exit();

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// Must also wait for content ready so that bundle is fully downloaded.
this._contentReady();
};
App.prototype._finishInit = function() {
var script = this._getScript();
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
this.<span class="apidocCodeKeywordSpan">emit</span>(&#x27;model&#x27;, this.model);
util.isProduction = data.nodeEnv === &#x27;production&#x27;;
if (!util.isProduction) this._autoRefresh();
this.model.unbundle(data);
var page = this.createPage();
page.params = this.model.get(&#x27;$render.params&#x27;);
this.emit(&#x27;ready&#x27;, page);
this._waitForAttach = false;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.emitCancellable" id="apidoc.element.derby.Controller.prototype.emitCancellable">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>emitCancellable
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">emitCancellable = function () {
  var cancelled = false;
  function cancel() {
    cancelled = true;
  }

  var args = Array.prototype.slice.call(arguments);
  args.push(cancel);
  this.emit.apply(this, args);

  return cancelled;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.emitDelayable" id="apidoc.element.derby.Controller.prototype.emitDelayable">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>emitDelayable
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">emitDelayable = function () {
  var args = Array.prototype.slice.call(arguments);
  var callback = args.pop();

  var delayed = false;
  function delay() {
    delayed = true;
    return callback;
  }

  args.push(delay);
  this.emit.apply(this, args);
  if (!delayed) callback();

  return delayed;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.eventNames" id="apidoc.element.derby.Controller.prototype.eventNames">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>eventNames
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function eventNames() {
  return this._eventsCount &#x3e; 0 ? Reflect.ownKeys(this._events) : [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.getMaxListeners" id="apidoc.element.derby.Controller.prototype.getMaxListeners">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>getMaxListeners
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMaxListeners() {
  return $getMaxListeners(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.listenerCount" id="apidoc.element.derby.Controller.prototype.listenerCount">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>listenerCount
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function listenerCount(type) {
  const events = this._events;

  if (events) {
    const evlistener = events[type];

    if (typeof evlistener === &#x27;function&#x27;) {
      return 1;
    } else if (evlistener) {
      return evlistener.length;
    }
  }

  return 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.listeners" id="apidoc.element.derby.Controller.prototype.listeners">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>listeners
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function listeners(type) {
  var evlistener;
  var ret;
  var events = this._events;

  if (!events)
    ret = [];
  else {
    evlistener = events[type];
    if (!evlistener)
      ret = [];
    else if (typeof evlistener === &#x27;function&#x27;)
      ret = [evlistener];
    else
      ret = arrayClone(evlistener, evlistener.length);
  }

  return ret;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.on" id="apidoc.element.derby.Controller.prototype.on">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>on
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addListener(type, listener) {
  return _addListener(this, type, listener, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Overriden on server
App.prototype._init = function() {
this._waitForAttach = true;
this._cancelAttach = false;
this.model = new this.derby.Model();
serializedViews(derbyTemplates, this.views);
// Must init async so that app.<span class="apidocCodeKeywordSpan">on</span>(&#x27;model&#x27;) listeners can be added.
// Must also wait for content ready so that bundle is fully downloaded.
this._contentReady();
};
App.prototype._finishInit = function() {
var script = this._getScript();
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.once" id="apidoc.element.derby.Controller.prototype.once">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>once
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function once(type, listener) {
  if (typeof listener !== &#x27;function&#x27;)
    throw new TypeError(&#x27;&#x22;listener&#x22; argument must be a function&#x27;);
  this.on(type, _onceWrap(this, type, listener));
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
options || (options = {});
if (options.minify == null) options.minify = util.isProduction;
// Turn all of the app&#x27;s currently registered views into a javascript
// function that can recreate them in the client
var viewsSource = this._viewsSource(options);
var bundleFiles = [];
backend.<span class="apidocCodeKeywordSpan">once</span>(&#x27;bundle&#x27;, function(bundle) {
  bundle.require(path.dirname(__dirname), {expose: &#x27;derby&#x27;});
  // Hack to inject the views script into the Browserify bundle by replacing
  // the empty _views.js file with the generated source
  var viewsFilename = require.resolve(&#x27;./_views&#x27;);
  bundle.transform(function(filename) {
    if (filename !== viewsFilename) return through();
    return through(
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.prependListener" id="apidoc.element.derby.Controller.prototype.prependListener">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>prependListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function prependListener(type, listener) {
  return _addListener(this, type, listener, true);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.prependOnceListener" id="apidoc.element.derby.Controller.prototype.prependOnceListener">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>prependOnceListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function prependOnceListener(type, listener) {
  if (typeof listener !== &#x27;function&#x27;)
    throw new TypeError(&#x27;&#x22;listener&#x22; argument must be a function&#x27;);
  this.prependListener(type, _onceWrap(this, type, listener));
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.removeAllListeners" id="apidoc.element.derby.Controller.prototype.removeAllListeners">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>removeAllListeners
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function removeAllListeners(type) {
  var listeners, events;

  events = this._events;
  if (!events)
    return this;

  // not listening for removeListener, no need to emit
  if (!events.removeListener) {
    if (arguments.length === 0) {
      this._events = new EventHandlers();
      this._eventsCount = 0;
    } else if (events[type]) {
      if (--this._eventsCount === 0)
        this._events = new EventHandlers();
      else
        delete events[type];
    }
    return this;
  }

  // emit removeListener for all listeners on all events
  if (arguments.length === 0) {
    var keys = Object.keys(events);
    for (var i = 0, key; i &#x3c; keys.length; ++i) {
      key = keys[i];
      if (key === &#x27;removeListener&#x27;) continue;
      this.removeAllListeners(key);
    }
    this.removeAllListeners(&#x27;removeListener&#x27;);
    this._events = new EventHandlers();
    this._eventsCount = 0;
    return this;
  }

  listeners = events[type];

  if (typeof listeners === &#x27;function&#x27;) {
    this.removeListener(type, listeners);
  } else if (listeners) {
    // LIFO order
    do {
      this.removeListener(type, listeners[listeners.length - 1]);
    } while (listeners[0]);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.removeListener" id="apidoc.element.derby.Controller.prototype.removeListener">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>removeListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function removeListener(type, listener) {
  var list, events, position, i, originalListener;

  if (typeof listener !== &#x27;function&#x27;)
    throw new TypeError(&#x27;&#x22;listener&#x22; argument must be a function&#x27;);

  events = this._events;
  if (!events)
    return this;

  list = events[type];
  if (!list)
    return this;

  if (list === listener || list.listener === listener) {
    if (--this._eventsCount === 0)
      this._events = new EventHandlers();
    else {
      delete events[type];
      if (events.removeListener)
        this.emit(&#x27;removeListener&#x27;, type, list.listener || listener);
    }
  } else if (typeof list !== &#x27;function&#x27;) {
    position = -1;

    for (i = list.length; i-- &#x3e; 0;) {
      if (list[i] === listener || list[i].listener === listener) {
        originalListener = list[i].listener;
        position = i;
        break;
      }
    }

    if (position &#x3c; 0)
      return this;

    if (list.length === 1) {
      list[0] = undefined;
      if (--this._eventsCount === 0) {
        this._events = new EventHandlers();
        return this;
      } else {
        delete events[type];
      }
    } else {
      spliceOne(list, position);
    }

    if (events.removeListener)
      this.emit(&#x27;removeListener&#x27;, type, originalListener || listener);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  useCapture = listener;
  listener = target;
  target = document;
}
this.addListener(type, target, wrappedListener, useCapture);
var dom = this;
function wrappedListener() {
  dom.<span class="apidocCodeKeywordSpan">removeListener</span>(type, target, wrappedListener, useCapture);
  return listener.apply(this, arguments);
}
};

Dom.prototype.removeListener = function(type, target, listener, useCapture) {
if (typeof target === &#x27;function&#x27;) {
  useCapture = listener;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Controller.prototype.setMaxListeners" id="apidoc.element.derby.Controller.prototype.setMaxListeners">
        function <span class="apidocSignatureSpan">derby.Controller.prototype.</span>setMaxListeners
        <span class="apidocSignatureSpan">(n)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setMaxListeners(n) {
  if (typeof n !== &#x27;number&#x27; || n &#x3c; 0 || isNaN(n))
    throw new TypeError(&#x27;&#x22;n&#x22; argument must be a positive number&#x27;);
  this._maxListeners = n;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.Derby" id="apidoc.module.derby.Derby">module derby.Derby</a></h1>


    <h2>
        <a href="#apidoc.element.derby.Derby.Derby" id="apidoc.element.derby.Derby.Derby">
        function <span class="apidocSignatureSpan">derby.</span>Derby
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Derby() {}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.Derby.prototype" id="apidoc.module.derby.Derby.prototype">module derby.Derby.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.derby.Derby.prototype.App" id="apidoc.element.derby.Derby.prototype.App">
        function <span class="apidocSignatureSpan">derby.Derby.prototype.</span>App
        <span class="apidocSignatureSpan">(derby, name, filename, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function App(derby, name, filename, options) {
  EventEmitter.call(this);
  this.derby = derby;
  this.name = name;
  this.filename = filename;
  this.scriptHash = &#x27;{{DERBY_SCRIPT_HASH}}&#x27;;
  this.bundledAt = &#x27;{{DERBY_BUNDLED_AT}}&#x27;;
  this.Page = createAppPage();
  this.proto = this.Page.prototype;
  this.views = new derbyTemplates.templates.Views();
  this.tracksRoutes = tracks.setup(this);
  this.model = null;
  this.page = null;
  this._init(options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Derby.prototype.Component" id="apidoc.element.derby.Derby.prototype.Component">
        function <span class="apidocSignatureSpan">derby.Derby.prototype.</span>Component
        <span class="apidocSignatureSpan">(parent, context, id, scope)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Component(parent, context, id, scope) {
  this.parent = parent;
  this.context = context;
  this.id = id;
  this._scope = scope;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Derby.prototype.Page" id="apidoc.element.derby.Derby.prototype.Page">
        function <span class="apidocSignatureSpan">derby.Derby.prototype.</span>Page
        <span class="apidocSignatureSpan">(app, model, req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Page(app, model, req, res) {
  Controller.call(this, app, this, model);
  this.req = req;
  this.res = res;
  this.params = null;
  if (this.init) this.init(model);
  this.context = this._createContext();
  this._eventModel = null;
  this._removeModelListeners = null;
  this._components = {};
  this._addListeners();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
App.prototype.loadStyles = function() {};

App.prototype.createPage = function() {
if (this.page) {
  this.emit(&#x27;destroyPage&#x27;, this.page);
  this.page.destroy();
}
var page = new this.<span class="apidocCodeKeywordSpan">Page</span>(this, this.model);
this.page = page;
return page;
};

App.prototype.onRoute = function(callback, page, next, done) {
if (this._waitForAttach) {
  // Cancel any routing before the initial page attachment. Instead, do a
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Derby.prototype.createApp" id="apidoc.element.derby.Derby.prototype.createApp">
        function <span class="apidocSignatureSpan">derby.Derby.prototype.</span>createApp
        <span class="apidocSignatureSpan">(name, filename, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createApp = function (name, filename, options) {
  return new App(this, name, filename, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Derby.prototype.run" id="apidoc.element.derby.Derby.prototype.run">
        function <span class="apidocSignatureSpan">derby.Derby.prototype.</span>run
        <span class="apidocSignatureSpan">(createServer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">run = function (createServer) {
  // In production
  if (this.util.isProduction) return createServer();
  if (cluster.isMaster) {
    console.log(&#x27;Master pid &#x27;, process.pid);
    startWorker();
  } else {
    createServer();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.Dom" id="apidoc.module.derby.Dom">module derby.Dom</a></h1>


    <h2>
        <a href="#apidoc.element.derby.Dom.Dom" id="apidoc.element.derby.Dom.Dom">
        function <span class="apidocSignatureSpan">derby.</span>Dom
        <span class="apidocSignatureSpan">(controller)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Dom(controller) {
  this.controller = controller;
  this._listeners = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.Dom.prototype" id="apidoc.module.derby.Dom.prototype">module derby.Dom.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.derby.Dom.prototype._initListeners" id="apidoc.element.derby.Dom.prototype._initListeners">
        function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>_initListeners
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_initListeners = function () {
  var dom = this;
  this.controller.on(&#x27;destroy&#x27;, function domOnDestroy() {
    var listeners = dom._listeners;
    if (!listeners) return;
    for (var i = listeners.length; i--;) {
      listeners[i].remove();
    }
    dom._listeners = null;
  });
  return this._listeners = [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    listener = target;
    target = document;
  }
  var domListener =
    (type === &#x27;destroy&#x27;) ? new DestroyListener(target, listener) :
    new DomListener(type, target, listener, useCapture);
  if (-1 === this._listenerIndex(domListener)) {
    var listeners = this._listeners || this.<span class="apidocCodeKeywordSpan">_initListeners</span>();
    listeners.push(domListener);
  }
  domListener.add();
};
Dom.prototype.on = Dom.prototype.addListener;

Dom.prototype.once = function(type, target, listener, useCapture) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Dom.prototype._listenerIndex" id="apidoc.element.derby.Dom.prototype._listenerIndex">
        function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>_listenerIndex
        <span class="apidocSignatureSpan">(domListener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_listenerIndex = function (domListener) {
  var listeners = this._listeners;
  if (!listeners) return -1;
  for (var i = listeners.length; i--;) {
    if (listeners[i].equals(domListener)) return i;
  }
  return -1;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    useCapture = listener;
    listener = target;
    target = document;
  }
  var domListener =
    (type === &#x27;destroy&#x27;) ? new DestroyListener(target, listener) :
    new DomListener(type, target, listener, useCapture);
  if (-1 === this.<span class="apidocCodeKeywordSpan">_listenerIndex</span>(domListener)) {
    var listeners = this._listeners || this._initListeners();
    listeners.push(domListener);
  }
  domListener.add();
};
Dom.prototype.on = Dom.prototype.addListener;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Dom.prototype.addListener" id="apidoc.element.derby.Dom.prototype.addListener">
        function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>addListener
        <span class="apidocSignatureSpan">(type, target, listener, useCapture)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addListener = function (type, target, listener, useCapture) {
  if (typeof target === &#x27;function&#x27;) {
    useCapture = listener;
    listener = target;
    target = document;
  }
  var domListener =
    (type === &#x27;destroy&#x27;) ? new DestroyListener(target, listener) :
    new DomListener(type, target, listener, useCapture);
  if (-1 === this._listenerIndex(domListener)) {
    var listeners = this._listeners || this._initListeners();
    listeners.push(domListener);
  }
  domListener.add();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Dom.prototype.once = function(type, target, listener, useCapture) {
  if (typeof target === &#x27;function&#x27;) {
    useCapture = listener;
    listener = target;
    target = document;
  }
  this.<span class="apidocCodeKeywordSpan">addListener</span>(type, target, wrappedListener, useCapture);
  var dom = this;
  function wrappedListener() {
    dom.removeListener(type, target, wrappedListener, useCapture);
    return listener.apply(this, arguments);
  }
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Dom.prototype.on" id="apidoc.element.derby.Dom.prototype.on">
        function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>on
        <span class="apidocSignatureSpan">(type, target, listener, useCapture)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">on = function (type, target, listener, useCapture) {
  if (typeof target === &#x27;function&#x27;) {
    useCapture = listener;
    listener = target;
    target = document;
  }
  var domListener =
    (type === &#x27;destroy&#x27;) ? new DestroyListener(target, listener) :
    new DomListener(type, target, listener, useCapture);
  if (-1 === this._listenerIndex(domListener)) {
    var listeners = this._listeners || this._initListeners();
    listeners.push(domListener);
  }
  domListener.add();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Overriden on server
App.prototype._init = function() {
this._waitForAttach = true;
this._cancelAttach = false;
this.model = new this.derby.Model();
serializedViews(derbyTemplates, this.views);
// Must init async so that app.<span class="apidocCodeKeywordSpan">on</span>(&#x27;model&#x27;) listeners can be added.
// Must also wait for content ready so that bundle is fully downloaded.
this._contentReady();
};
App.prototype._finishInit = function() {
var script = this._getScript();
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Dom.prototype.once" id="apidoc.element.derby.Dom.prototype.once">
        function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>once
        <span class="apidocSignatureSpan">(type, target, listener, useCapture)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">once = function (type, target, listener, useCapture) {
  if (typeof target === &#x27;function&#x27;) {
    useCapture = listener;
    listener = target;
    target = document;
  }
  this.addListener(type, target, wrappedListener, useCapture);
  var dom = this;
  function wrappedListener() {
    dom.removeListener(type, target, wrappedListener, useCapture);
    return listener.apply(this, arguments);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
options || (options = {});
if (options.minify == null) options.minify = util.isProduction;
// Turn all of the app&#x27;s currently registered views into a javascript
// function that can recreate them in the client
var viewsSource = this._viewsSource(options);
var bundleFiles = [];
backend.<span class="apidocCodeKeywordSpan">once</span>(&#x27;bundle&#x27;, function(bundle) {
  bundle.require(path.dirname(__dirname), {expose: &#x27;derby&#x27;});
  // Hack to inject the views script into the Browserify bundle by replacing
  // the empty _views.js file with the generated source
  var viewsFilename = require.resolve(&#x27;./_views&#x27;);
  bundle.transform(function(filename) {
    if (filename !== viewsFilename) return through();
    return through(
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Dom.prototype.removeListener" id="apidoc.element.derby.Dom.prototype.removeListener">
        function <span class="apidocSignatureSpan">derby.Dom.prototype.</span>removeListener
        <span class="apidocSignatureSpan">(type, target, listener, useCapture)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">removeListener = function (type, target, listener, useCapture) {
  if (typeof target === &#x27;function&#x27;) {
    useCapture = listener;
    listener = target;
    target = document;
  }
  var domListener = new DomListener(type, target, listener, useCapture);
  domListener.remove();
  var i = this._listenerIndex(domListener);
  if (i &#x3e; -1) this._listeners.splice(i, 1);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  useCapture = listener;
  listener = target;
  target = document;
}
this.addListener(type, target, wrappedListener, useCapture);
var dom = this;
function wrappedListener() {
  dom.<span class="apidocCodeKeywordSpan">removeListener</span>(type, target, wrappedListener, useCapture);
  return listener.apply(this, arguments);
}
};

Dom.prototype.removeListener = function(type, target, listener, useCapture) {
if (typeof target === &#x27;function&#x27;) {
  useCapture = listener;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.Page" id="apidoc.module.derby.Page">module derby.Page</a></h1>


    <h2>
        <a href="#apidoc.element.derby.Page.Page" id="apidoc.element.derby.Page.Page">
        function <span class="apidocSignatureSpan">derby.</span>Page
        <span class="apidocSignatureSpan">(app, model, req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Page(app, model, req, res) {
  Controller.call(this, app, this, model);
  this.req = req;
  this.res = res;
  this.params = null;
  if (this.init) this.init(model);
  this.context = this._createContext();
  this._eventModel = null;
  this._removeModelListeners = null;
  this._components = {};
  this._addListeners();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
App.prototype.loadStyles = function() {};

App.prototype.createPage = function() {
if (this.page) {
  this.emit(&#x27;destroyPage&#x27;, this.page);
  this.page.destroy();
}
var page = new this.<span class="apidocCodeKeywordSpan">Page</span>(this, this.model);
this.page = page;
return page;
};

App.prototype.onRoute = function(callback, page, next, done) {
if (this._waitForAttach) {
  // Cancel any routing before the initial page attachment. Instead, do a
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.Page.prototype" id="apidoc.module.derby.Page.prototype">module derby.Page.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.derby.Page.prototype._addContextListeners" id="apidoc.element.derby.Page.prototype._addContextListeners">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_addContextListeners
        <span class="apidocSignatureSpan">(eventModel)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_addContextListeners = function (eventModel) {
  this.context.meta.addBinding = addBinding;
  this.context.meta.removeBinding = removeBinding;
  this.context.meta.removeNode = removeNode;
  this.context.meta.addItemContext = addItemContext;
  this.context.meta.removeItemContext = removeItemContext;

  function addItemContext(context) {
    var segments = context.expression.resolve(context);
    eventModel.addItemContext(segments, context);
  }
  function removeItemContext(context) {
    // TODO
  }
  function addBinding(binding) {
    patchTextBinding(binding);
    var expressions = binding.template.expressions;
    if (expressions) {
      for (var i = 0, len = expressions.length; i &#x3c; len; i++) {
        addDependencies(eventModel, expressions[i], binding);
      }
    } else {
      var expression = binding.template.expression;
      addDependencies(eventModel, expression, binding);
    }
  }
  function removeBinding(binding) {
    var bindingWrappers = binding.meta;
    if (!bindingWrappers) return;
    for (var i = bindingWrappers.length; i--;) {
      eventModel.removeBinding(bindingWrappers[i]);
    }
  }
  function removeNode(node) {
    var component = node.$component;
    if (component &#x26;&#x26; !component.singleton) {
      component.destroy();
    }
    var destroyListeners = node.$destroyListeners;
    if (destroyListeners) {
      for (var i = 0; i &#x3c; destroyListeners.length; i++) {
        destroyListeners[i]();
      }
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
context.alias = &#x27;#root&#x27;;
return context;
};

Page.prototype._addListeners = function() {
var eventModel = this._eventModel = new EventModel();
this._addModelListeners(eventModel);
this.<span class="apidocCodeKeywordSpan">_addContextListeners</span>(eventModel);
};

Page.prototype.destroy = function() {
this.emit(&#x27;destroy&#x27;);
this._removeModelListeners();
for (var id in this._components) {
  var component = this._components[id];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype._addListeners" id="apidoc.element.derby.Page.prototype._addListeners">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_addListeners
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_addListeners = function () {}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.res = res;
this.params = null;
if (this.init) this.init(model);
this.context = this._createContext();
this._eventModel = null;
this._removeModelListeners = null;
this._components = {};
this.<span class="apidocCodeKeywordSpan">_addListeners</span>();
}

util.mergeInto(Page.prototype, Controller.prototype);

Page.prototype.$bodyClass = function(ns) {
if (!ns) return;
var classNames = [];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype._addModelListeners" id="apidoc.element.derby.Page.prototype._addModelListeners">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_addModelListeners
        <span class="apidocSignatureSpan">(eventModel)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_addModelListeners = function (eventModel) {
  var model = this.model;
  if (!model) return;

  var context = this.context;
  var changeListener = model.on(&#x27;change&#x27;, &#x27;**&#x27;, function onChange(path, value, previous, pass) {
    var segments = util.castSegments(path.split(&#x27;.&#x27;));
    // The pass parameter is passed in for special handling of updates
    // resulting from stringInsert or stringRemove
    eventModel.set(segments, previous, pass);
  });
  var loadListener = model.on(&#x27;load&#x27;, &#x27;**&#x27;, function onLoad(path) {
    var segments = util.castSegments(path.split(&#x27;.&#x27;));
    eventModel.set(segments);
  });
  var unloadListener = model.on(&#x27;unload&#x27;, &#x27;**&#x27;, function onUnload(path) {
    var segments = util.castSegments(path.split(&#x27;.&#x27;));
    eventModel.set(segments);
  });
  var insertListener = model.on(&#x27;insert&#x27;, &#x27;**&#x27;, function onInsert(path, index, values) {
    var segments = util.castSegments(path.split(&#x27;.&#x27;));
    eventModel.insert(segments, index, values.length);
  });
  var removeListener = model.on(&#x27;remove&#x27;, &#x27;**&#x27;, function onRemove(path, index, values) {
    var segments = util.castSegments(path.split(&#x27;.&#x27;));
    eventModel.remove(segments, index, values.length);
  });
  var moveListener = model.on(&#x27;move&#x27;, &#x27;**&#x27;, function onMove(path, from, to, howMany) {
    var segments = util.castSegments(path.split(&#x27;.&#x27;));
    eventModel.move(segments, from, to, howMany);
  });

  this._removeModelListeners = function() {
    model.removeListener(&#x27;change&#x27;, changeListener);
    model.removeListener(&#x27;load&#x27;, loadListener);
    model.removeListener(&#x27;unload&#x27;, unloadListener);
    model.removeListener(&#x27;insert&#x27;, insertListener);
    model.removeListener(&#x27;remove&#x27;, removeListener);
    model.removeListener(&#x27;move&#x27;, moveListener);
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
context.expression = new expressions.PathExpression([]);
context.alias = &#x27;#root&#x27;;
return context;
};

Page.prototype._addListeners = function() {
var eventModel = this._eventModel = new EventModel();
this.<span class="apidocCodeKeywordSpan">_addModelListeners</span>(eventModel);
this._addContextListeners(eventModel);
};

Page.prototype.destroy = function() {
this.emit(&#x27;destroy&#x27;);
this._removeModelListeners();
for (var id in this._components) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype._createContext" id="apidoc.element.derby.Page.prototype._createContext">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_createContext
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createContext = function () {
  var contextMeta = new contexts.ContextMeta();
  contextMeta.views = this.app &#x26;&#x26; this.app.views;
  var context = new contexts.Context(contextMeta, this);
  context.expression = new expressions.PathExpression([]);
  context.alias = &#x27;#root&#x27;;
  return context;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

function Page(app, model, req, res) {
  Controller.call(this, app, this, model);
  this.req = req;
  this.res = res;
  this.params = null;
  if (this.init) this.init(model);
  this.context = this.<span class="apidocCodeKeywordSpan">_createContext</span>();
  this._eventModel = null;
  this._removeModelListeners = null;
  this._components = {};
  this._addListeners();
}

util.mergeInto(Page.prototype, Controller.prototype);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype._setRenderParams" id="apidoc.element.derby.Page.prototype._setRenderParams">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_setRenderParams
        <span class="apidocSignatureSpan">(ns)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_setRenderParams = function (ns) {
  this.model.set(&#x27;$render.ns&#x27;, ns);
  this.model.set(&#x27;$render.params&#x27;, this.params);
  this.model.set(&#x27;$render.url&#x27;, this.params &#x26;&#x26; this.params.url);
  this.model.set(&#x27;$render.query&#x27;, this.params &#x26;&#x26; this.params.query);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Page.prototype.getView = function(viewName, ns) {
return this.app.views.find(viewName, ns);
};

Page.prototype.render = function(ns) {
this.app.emit(&#x27;render&#x27;, this);
this.context.pause();
this.<span class="apidocCodeKeywordSpan">_setRenderParams</span>(ns);
var titleFragment = this.getFragment(&#x27;TitleElement&#x27;, ns);
var bodyFragment = this.getFragment(&#x27;BodyElement&#x27;, ns);
var titleElement = document.getElementsByTagName(&#x27;title&#x27;)[0];
titleElement.parentNode.replaceChild(titleFragment, titleElement);
document.body.parentNode.replaceChild(bodyFragment, document.body);
this.context.unpause();
if (this.create) this.create(this.model, this.dom);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype._setRenderPrefix" id="apidoc.element.derby.Page.prototype._setRenderPrefix">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>_setRenderPrefix
        <span class="apidocSignatureSpan">(ns)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_setRenderPrefix = function (ns) {
  var prefix = (ns) ? ns + &#x27;:&#x27; : &#x27;&#x27;;
  this.model.set(&#x27;$render.prefix&#x27;, prefix);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Page.prototype._setRenderPrefix = function(ns) {
var prefix = (ns) ? ns + &#x27;:&#x27; : &#x27;&#x27;;
this.model.set(&#x27;$render.prefix&#x27;, prefix);
};

Page.prototype.get = function(viewName, ns, unescaped) {
this.<span class="apidocCodeKeywordSpan">_setRenderPrefix</span>(ns);
var view = this.getView(viewName, ns);
return view.get(this.context, unescaped);
};

Page.prototype.getFragment = function(viewName, ns) {
this._setRenderPrefix(ns);
var view = this.getView(viewName, ns);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.addListener" id="apidoc.element.derby.Page.prototype.addListener">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>addListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addListener(type, listener) {
  return _addListener(this, type, listener, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Dom.prototype.once = function(type, target, listener, useCapture) {
  if (typeof target === &#x27;function&#x27;) {
    useCapture = listener;
    listener = target;
    target = document;
  }
  this.<span class="apidocCodeKeywordSpan">addListener</span>(type, target, wrappedListener, useCapture);
  var dom = this;
  function wrappedListener() {
    dom.removeListener(type, target, wrappedListener, useCapture);
    return listener.apply(this, arguments);
  }
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.attach" id="apidoc.element.derby.Page.prototype.attach">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>attach
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">attach = function () {
  this.context.pause();
  var ns = this.model.get(&#x27;$render.ns&#x27;);
  var titleView = this.getView(&#x27;TitleElement&#x27;, ns);
  var bodyView = this.getView(&#x27;BodyElement&#x27;, ns);
  var titleElement = document.getElementsByTagName(&#x27;title&#x27;)[0];
  titleView.attachTo(titleElement.parentNode, titleElement, this.context);
  bodyView.attachTo(document.body.parentNode, document.body, this.context);
  this.context.unpause();
  if (this.create) this.create(this.model, this.dom);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  return;
}
// Since an attachment failure is *fatal* and could happen as a result of a
// browser extension like AdBlock, an invalid template, or a small bug in
// Derby or Saddle, re-render from scratch on production failures
if (util.isProduction) {
  try {
    page.<span class="apidocCodeKeywordSpan">attach</span>();
  } catch (err) {
    this.history.refresh();
    console.warn(&#x27;attachment error&#x27;, err.stack);
  }
} else {
  page.attach();
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.destroy" id="apidoc.element.derby.Page.prototype.destroy">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>destroy
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">destroy = function () {
  this.emit(&#x27;destroy&#x27;);
  this._removeModelListeners();
  for (var id in this._components) {
    var component = this._components[id];
    component.destroy();
  }
  // Remove all data, refs, listeners, and reactive functions
  // for the previous page
  var silentModel = this.model.silent();
  silentModel.destroy(&#x27;_page&#x27;);
  silentModel.destroy(&#x27;$components&#x27;);
  // Unfetch and unsubscribe from all queries and documents
  silentModel.unloadAll &#x26;&#x26; silentModel.unloadAll();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
App.prototype.loadViews = function() {};

App.prototype.loadStyles = function() {};

App.prototype.createPage = function() {
  if (this.page) {
    this.emit(&#x27;destroyPage&#x27;, this.page);
    this.page.<span class="apidocCodeKeywordSpan">destroy</span>();
  }
  var page = new this.Page(this, this.model);
  this.page = page;
  return page;
};

App.prototype.onRoute = function(callback, page, next, done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.emit" id="apidoc.element.derby.Page.prototype.emit">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>emit
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function emit(type) {
  var er, handler, len, args, i, events, domain;
  var needDomainExit = false;
  var doError = (type === &#x27;error&#x27;);

  events = this._events;
  if (events)
    doError = (doError &#x26;&#x26; events.error == null);
  else if (!doError)
    return false;

  domain = this.domain;

  // If there is no &#x27;error&#x27; event listener then throw.
  if (doError) {
    er = arguments[1];
    if (domain) {
      if (!er)
        er = new Error(&#x27;Uncaught, unspecified &#x22;error&#x22; event&#x27;);
      er.domainEmitter = this;
      er.domain = domain;
      er.domainThrown = false;
      domain.emit(&#x27;error&#x27;, er);
    } else if (er instanceof Error) {
      throw er; // Unhandled &#x27;error&#x27; event
    } else {
      // At least give some kind of context to the user
      var err = new Error(&#x27;Uncaught, unspecified &#x22;error&#x22; event. (&#x27; + er + &#x27;)&#x27;);
      err.context = er;
      throw err;
    }
    return false;
  }

  handler = events[type];

  if (!handler)
    return false;

  if (domain &#x26;&#x26; this !== process) {
    domain.enter();
    needDomainExit = true;
  }

  var isFn = typeof handler === &#x27;function&#x27;;
  len = arguments.length;
  switch (len) {
    // fast cases
    case 1:
      emitNone(handler, isFn, this);
      break;
    case 2:
      emitOne(handler, isFn, this, arguments[1]);
      break;
    case 3:
      emitTwo(handler, isFn, this, arguments[1], arguments[2]);
      break;
    case 4:
      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);
      break;
    // slower
    default:
      args = new Array(len - 1);
      for (i = 1; i &#x3c; len; i++)
        args[i - 1] = arguments[i];
      emitMany(handler, isFn, this, args);
  }

  if (needDomainExit)
    domain.exit();

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// Must also wait for content ready so that bundle is fully downloaded.
this._contentReady();
};
App.prototype._finishInit = function() {
var script = this._getScript();
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
this.<span class="apidocCodeKeywordSpan">emit</span>(&#x27;model&#x27;, this.model);
util.isProduction = data.nodeEnv === &#x27;production&#x27;;
if (!util.isProduction) this._autoRefresh();
this.model.unbundle(data);
var page = this.createPage();
page.params = this.model.get(&#x27;$render.params&#x27;);
this.emit(&#x27;ready&#x27;, page);
this._waitForAttach = false;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.emitCancellable" id="apidoc.element.derby.Page.prototype.emitCancellable">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>emitCancellable
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">emitCancellable = function () {
  var cancelled = false;
  function cancel() {
    cancelled = true;
  }

  var args = Array.prototype.slice.call(arguments);
  args.push(cancel);
  this.emit.apply(this, args);

  return cancelled;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.emitDelayable" id="apidoc.element.derby.Page.prototype.emitDelayable">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>emitDelayable
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">emitDelayable = function () {
  var args = Array.prototype.slice.call(arguments);
  var callback = args.pop();

  var delayed = false;
  function delay() {
    delayed = true;
    return callback;
  }

  args.push(delay);
  this.emit.apply(this, args);
  if (!delayed) callback();

  return delayed;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.eventNames" id="apidoc.element.derby.Page.prototype.eventNames">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>eventNames
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function eventNames() {
  return this._eventsCount &#x3e; 0 ? Reflect.ownKeys(this._events) : [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.get" id="apidoc.element.derby.Page.prototype.get">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>get
        <span class="apidocSignatureSpan">(viewName, ns, unescaped)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (viewName, ns, unescaped) {
  this._setRenderPrefix(ns);
  var view = this.getView(viewName, ns);
  return view.get(this.context, unescaped);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
this.emit(&#x27;model&#x27;, this.model);
util.isProduction = data.nodeEnv === &#x27;production&#x27;;
if (!util.isProduction) this._autoRefresh();
this.model.unbundle(data);
var page = this.createPage();
page.params = this.model.<span class="apidocCodeKeywordSpan">get</span>(&#x27;$render.params&#x27;);
this.emit(&#x27;ready&#x27;, page);
this._waitForAttach = false;
// Instead of attaching, do a route and render if a link was clicked before
// the page finished attaching
if (this._cancelAttach) {
  this.history.refresh();
  return;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.getFragment" id="apidoc.element.derby.Page.prototype.getFragment">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>getFragment
        <span class="apidocSignatureSpan">(viewName, ns)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getFragment = function (viewName, ns) {
  this._setRenderPrefix(ns);
  var view = this.getView(viewName, ns);
  return view.getFragment(this.context);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var view = this.getView(viewName, ns);
  return view.get(this.context, unescaped);
};

Page.prototype.getFragment = function(viewName, ns) {
  this._setRenderPrefix(ns);
  var view = this.getView(viewName, ns);
  return view.<span class="apidocCodeKeywordSpan">getFragment</span>(this.context);
};

Page.prototype.getView = function(viewName, ns) {
  return this.app.views.find(viewName, ns);
};

Page.prototype.render = function(ns) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.getMaxListeners" id="apidoc.element.derby.Page.prototype.getMaxListeners">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>getMaxListeners
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMaxListeners() {
  return $getMaxListeners(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.getView" id="apidoc.element.derby.Page.prototype.getView">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>getView
        <span class="apidocSignatureSpan">(viewName, ns)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getView = function (viewName, ns) {
  return this.app.views.find(viewName, ns);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Page.prototype._setRenderPrefix = function(ns) {
var prefix = (ns) ? ns + &#x27;:&#x27; : &#x27;&#x27;;
this.model.set(&#x27;$render.prefix&#x27;, prefix);
};

Page.prototype.get = function(viewName, ns, unescaped) {
this._setRenderPrefix(ns);
var view = this.<span class="apidocCodeKeywordSpan">getView</span>(viewName, ns);
return view.get(this.context, unescaped);
};

Page.prototype.getFragment = function(viewName, ns) {
this._setRenderPrefix(ns);
var view = this.getView(viewName, ns);
return view.getFragment(this.context);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.listenerCount" id="apidoc.element.derby.Page.prototype.listenerCount">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>listenerCount
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function listenerCount(type) {
  const events = this._events;

  if (events) {
    const evlistener = events[type];

    if (typeof evlistener === &#x27;function&#x27;) {
      return 1;
    } else if (evlistener) {
      return evlistener.length;
    }
  }

  return 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.listeners" id="apidoc.element.derby.Page.prototype.listeners">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>listeners
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function listeners(type) {
  var evlistener;
  var ret;
  var events = this._events;

  if (!events)
    ret = [];
  else {
    evlistener = events[type];
    if (!evlistener)
      ret = [];
    else if (typeof evlistener === &#x27;function&#x27;)
      ret = [evlistener];
    else
      ret = arrayClone(evlistener, evlistener.length);
  }

  return ret;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.on" id="apidoc.element.derby.Page.prototype.on">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>on
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addListener(type, listener) {
  return _addListener(this, type, listener, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Overriden on server
App.prototype._init = function() {
this._waitForAttach = true;
this._cancelAttach = false;
this.model = new this.derby.Model();
serializedViews(derbyTemplates, this.views);
// Must init async so that app.<span class="apidocCodeKeywordSpan">on</span>(&#x27;model&#x27;) listeners can be added.
// Must also wait for content ready so that bundle is fully downloaded.
this._contentReady();
};
App.prototype._finishInit = function() {
var script = this._getScript();
var data = JSON.parse(script.nextSibling.innerHTML);
this.model.createConnection(data);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.once" id="apidoc.element.derby.Page.prototype.once">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>once
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function once(type, listener) {
  if (typeof listener !== &#x27;function&#x27;)
    throw new TypeError(&#x27;&#x22;listener&#x22; argument must be a function&#x27;);
  this.on(type, _onceWrap(this, type, listener));
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
options || (options = {});
if (options.minify == null) options.minify = util.isProduction;
// Turn all of the app&#x27;s currently registered views into a javascript
// function that can recreate them in the client
var viewsSource = this._viewsSource(options);
var bundleFiles = [];
backend.<span class="apidocCodeKeywordSpan">once</span>(&#x27;bundle&#x27;, function(bundle) {
  bundle.require(path.dirname(__dirname), {expose: &#x27;derby&#x27;});
  // Hack to inject the views script into the Browserify bundle by replacing
  // the empty _views.js file with the generated source
  var viewsFilename = require.resolve(&#x27;./_views&#x27;);
  bundle.transform(function(filename) {
    if (filename !== viewsFilename) return through();
    return through(
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.prependListener" id="apidoc.element.derby.Page.prototype.prependListener">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>prependListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function prependListener(type, listener) {
  return _addListener(this, type, listener, true);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.prependOnceListener" id="apidoc.element.derby.Page.prototype.prependOnceListener">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>prependOnceListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function prependOnceListener(type, listener) {
  if (typeof listener !== &#x27;function&#x27;)
    throw new TypeError(&#x27;&#x22;listener&#x22; argument must be a function&#x27;);
  this.prependListener(type, _onceWrap(this, type, listener));
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.removeAllListeners" id="apidoc.element.derby.Page.prototype.removeAllListeners">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>removeAllListeners
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function removeAllListeners(type) {
  var listeners, events;

  events = this._events;
  if (!events)
    return this;

  // not listening for removeListener, no need to emit
  if (!events.removeListener) {
    if (arguments.length === 0) {
      this._events = new EventHandlers();
      this._eventsCount = 0;
    } else if (events[type]) {
      if (--this._eventsCount === 0)
        this._events = new EventHandlers();
      else
        delete events[type];
    }
    return this;
  }

  // emit removeListener for all listeners on all events
  if (arguments.length === 0) {
    var keys = Object.keys(events);
    for (var i = 0, key; i &#x3c; keys.length; ++i) {
      key = keys[i];
      if (key === &#x27;removeListener&#x27;) continue;
      this.removeAllListeners(key);
    }
    this.removeAllListeners(&#x27;removeListener&#x27;);
    this._events = new EventHandlers();
    this._eventsCount = 0;
    return this;
  }

  listeners = events[type];

  if (typeof listeners === &#x27;function&#x27;) {
    this.removeListener(type, listeners);
  } else if (listeners) {
    // LIFO order
    do {
      this.removeListener(type, listeners[listeners.length - 1]);
    } while (listeners[0]);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.removeListener" id="apidoc.element.derby.Page.prototype.removeListener">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>removeListener
        <span class="apidocSignatureSpan">(type, listener)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function removeListener(type, listener) {
  var list, events, position, i, originalListener;

  if (typeof listener !== &#x27;function&#x27;)
    throw new TypeError(&#x27;&#x22;listener&#x22; argument must be a function&#x27;);

  events = this._events;
  if (!events)
    return this;

  list = events[type];
  if (!list)
    return this;

  if (list === listener || list.listener === listener) {
    if (--this._eventsCount === 0)
      this._events = new EventHandlers();
    else {
      delete events[type];
      if (events.removeListener)
        this.emit(&#x27;removeListener&#x27;, type, list.listener || listener);
    }
  } else if (typeof list !== &#x27;function&#x27;) {
    position = -1;

    for (i = list.length; i-- &#x3e; 0;) {
      if (list[i] === listener || list[i].listener === listener) {
        originalListener = list[i].listener;
        position = i;
        break;
      }
    }

    if (position &#x3c; 0)
      return this;

    if (list.length === 1) {
      list[0] = undefined;
      if (--this._eventsCount === 0) {
        this._events = new EventHandlers();
        return this;
      } else {
        delete events[type];
      }
    } else {
      spliceOne(list, position);
    }

    if (events.removeListener)
      this.emit(&#x27;removeListener&#x27;, type, originalListener || listener);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  useCapture = listener;
  listener = target;
  target = document;
}
this.addListener(type, target, wrappedListener, useCapture);
var dom = this;
function wrappedListener() {
  dom.<span class="apidocCodeKeywordSpan">removeListener</span>(type, target, wrappedListener, useCapture);
  return listener.apply(this, arguments);
}
};

Dom.prototype.removeListener = function(type, target, listener, useCapture) {
if (typeof target === &#x27;function&#x27;) {
  useCapture = listener;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.render" id="apidoc.element.derby.Page.prototype.render">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>render
        <span class="apidocSignatureSpan">(status, ns)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">render = function (status, ns) {
  if (typeof status !== &#x27;number&#x27;) {
    ns = status;
    status = null;
  }
  this.app.emit(&#x27;render&#x27;, this);

  if (status) this.res.statusCode = status;
  // Prevent the browser from storing the HTML response in its back cache, since
  // that will cause it to render with the data from the initial load first
  this.res.setHeader(&#x27;Cache-Control&#x27;, &#x27;no-store&#x27;);
  // Set HTML utf-8 content type unless already set
  if (!this.res.getHeader(&#x27;Content-Type&#x27;)) {
    this.res.setHeader(&#x27;Content-Type&#x27;, &#x27;text/html; charset=utf-8&#x27;);
  }

  this._setRenderParams(ns);
  var pageHtml = this.get(&#x27;Page&#x27;, ns);
  this.res.write(pageHtml);

  var bundleScriptTag = &#x27;&#x3c;script async data-derby-app src=&#x22;&#x27; + this.app.scriptUrl + &#x27;&#x22;&#x27;;
  if (this.app.scriptCrossOrigin) {
    // Scripts loaded from a different origin (such as a CDN) won&#x27;t report
    // much information to the host page&#x27;s window.onerror. Adding the
    // &#x22;crossorigin&#x22; attribute to the script tag allows reporting of detailed
    // error info to the host page.
    // HOWEVER - if the &#x22;crossorigin&#x22; attribute is present for a script tag
    // with a cross-origin &#x22;src&#x22;, then the script&#x27;s HTTP response MUST have
    // an appropriate &#x22;Access-Control-Allow-Origin&#x22; header set. Otherwise,
    // the browser will refuse to load the script.
    bundleScriptTag += &#x27; crossorigin&#x27;;
  }
  bundleScriptTag += &#x27;&#x3e;&#x3c;/script&#x3e;&#x27;;
  this.res.write(bundleScriptTag);

  this.res.write(&#x27;&#x3c;script type=&#x22;application/json&#x22;&#x3e;&#x27;);
  var tailHtml = this.get(&#x27;Tail&#x27;, ns);

  this.model.destroy(&#x27;$components&#x27;);

  var page = this;
  this.model.bundle(function(err, bundle) {
    if (page.model.hasErrored) return;
    if (err) return page.emit(&#x27;error&#x27;, err);
    var json = stringifyBundle(bundle);
    page.res.write(json);
    page.res.end(&#x27;&#x3c;/script&#x3e;&#x27; + tailHtml);
    page.app.emit(&#x27;routeDone&#x27;, page, &#x27;render&#x27;);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

App.prototype._handleMessage = function(action, message) {
if (action === &#x27;refreshViews&#x27;) {
  var fn = new Function(&#x27;return &#x27; + message.views)(); // jshint ignore:line
  fn(derbyTemplates, this.views);
  var ns = this.model.get(&#x27;$render.ns&#x27;);
  this.page.<span class="apidocCodeKeywordSpan">render</span>(ns);

} else if (action === &#x27;refreshStyles&#x27;) {
  var styleElement = document.querySelector(&#x27;style[data-filename=&#x22;&#x27; +
    message.filename + &#x27;&#x22;]&#x27;);
  if (styleElement) styleElement.innerHTML = message.css;

} else if (action === &#x27;reload&#x27;) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.renderStatic" id="apidoc.element.derby.Page.prototype.renderStatic">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>renderStatic
        <span class="apidocSignatureSpan">(status, ns)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">renderStatic = function (status, ns) {
  if (typeof status !== &#x27;number&#x27;) {
    ns = status;
    status = null;
  }
  this.app.emit(&#x27;renderStatic&#x27;, this);

  if (status) this.res.statusCode = status;
  this.params = pageParams(this.req);
  this._setRenderParams(ns);
  var pageHtml = this.get(&#x27;Page&#x27;, ns);
  var tailHtml = this.get(&#x27;Tail&#x27;, ns);
  this.res.send(pageHtml + tailHtml);
  this.app.emit(&#x27;routeDone&#x27;, this, &#x27;renderStatic&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.Page.prototype.setMaxListeners" id="apidoc.element.derby.Page.prototype.setMaxListeners">
        function <span class="apidocSignatureSpan">derby.Page.prototype.</span>setMaxListeners
        <span class="apidocSignatureSpan">(n)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setMaxListeners(n) {
  if (typeof n !== &#x27;number&#x27; || n &#x3c; 0 || isNaN(n))
    throw new TypeError(&#x27;&#x22;n&#x22; argument must be a positive number&#x27;);
  this._maxListeners = n;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.components" id="apidoc.module.derby.components">module derby.components</a></h1>


    <h2>
        <a href="#apidoc.element.derby.components.Component" id="apidoc.element.derby.components.Component">
        function <span class="apidocSignatureSpan">derby.components.</span>Component
        <span class="apidocSignatureSpan">(parent, context, id, scope)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Component(parent, context, id, scope) {
  this.parent = parent;
  this.context = context;
  this.id = id;
  this._scope = scope;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.components.ComponentFactory" id="apidoc.element.derby.components.ComponentFactory">
        function <span class="apidocSignatureSpan">derby.components.</span>ComponentFactory
        <span class="apidocSignatureSpan">(constructor)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ComponentFactory(constructor) {
  this.constructor = constructor;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.components.SingletonComponentFactory" id="apidoc.element.derby.components.SingletonComponentFactory">
        function <span class="apidocSignatureSpan">derby.components.</span>SingletonComponentFactory
        <span class="apidocSignatureSpan">(constructor)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SingletonComponentFactory(constructor) {
  this.constructor = constructor;
  this.component = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.components.createFactory" id="apidoc.element.derby.components.createFactory">
        function <span class="apidocSignatureSpan">derby.components.</span>createFactory
        <span class="apidocSignatureSpan">(constructor)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createFactory(constructor) {
  return (constructor.prototype.singleton) ?
    new SingletonComponentFactory(constructor) :
    new ComponentFactory(constructor);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.documentListeners" id="apidoc.module.derby.documentListeners">module derby.documentListeners</a></h1>


    <h2>
        <a href="#apidoc.element.derby.documentListeners.add" id="apidoc.element.derby.documentListeners.add">
        function <span class="apidocSignatureSpan">derby.documentListeners.</span>add
        <span class="apidocSignatureSpan">(doc)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addDocumentListeners(doc) {
  doc.addEventListener(&#x27;input&#x27;, documentInput, true);
  doc.addEventListener(&#x27;change&#x27;, documentChange, true);

  // Listen to more events for versions of IE with buggy input event implementations
  if (parseFloat(window.navigator.appVersion.split(&#x27;MSIE &#x27;)[1]) &#x3c;= 9) {
    // We&#x27;re listening on selectionchange because there&#x27;s no other event emitted when
    // the user clicks &#x27;delete&#x27; from a context menu when right clicking on selected text.
    // So although this event fires overly aggressively, it&#x27;s the only real way
    // to ensure that we can detect all changes to the input value in IE &#x3c;= 9
    doc.addEventListener(&#x27;selectionchange&#x27;, function(e){
      if (document.activeElement) {
        documentInput({target: document.activeElement}); // selectionchange evts don&#x27;t have the e.target we need
      }
    }, true);
  }

  // For some reason valueAsNumber returns NaN for number inputs in IE
  // until a new IE version that handles this is released, parse input.value as a fallback
  var input = document.createElement(&#x27;input&#x27;);
  input.type = &#x27;number&#x27;;
  input.value = &#x27;7&#x27;;
  if (input.valueAsNumber !== input.valueAsNumber) {
    var oldInputValue = inputValue;
    inputValue = function(input) {
      if (input.type === &#x27;number&#x27;) {
        return inputIsNumberValue(input) ? parseFloat(input.value) : input.value;
      } else {
        return oldInputValue.apply(this, arguments);
      }
    };
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Derby.prototype.Component = components.Component;

Derby.prototype.createApp = function(name, filename, options) {
  return new App(this, name, filename, options);
};

if (!racer.util.isServer) {
  require(&#x27;./documentListeners&#x27;).<span class="apidocCodeKeywordSpan">add</span>(document);
}

racer.util.serverRequire(module, &#x27;./Derby.server&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.documentListeners.inputSupportsSelection" id="apidoc.element.derby.documentListeners.inputSupportsSelection">
        function <span class="apidocSignatureSpan">derby.documentListeners.</span>inputSupportsSelection
        <span class="apidocSignatureSpan">(input)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function inputSupportsSelection(input) {
  var type = input.type;
  return (
    type === &#x27;text&#x27; ||
    type === &#x27;textarea&#x27; ||
    type === &#x27;search&#x27; ||
    type === &#x27;url&#x27; ||
    type === &#x27;tel&#x27; ||
    type === &#x27;password&#x27;
  );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

function patchTextBinding(binding) {
  if (
    binding instanceof templates.AttributeBinding &#x26;&#x26;
    binding.name === &#x27;value&#x27; &#x26;&#x26;
    (binding.element.tagName === &#x27;INPUT&#x27; || binding.element.tagName === &#x27;TEXTAREA&#x27;) &#x26;&#x26;
    documentListeners.<span class="apidocCodeKeywordSpan">inputSupportsSelection</span>(binding.element) &#x26;&#x26;
    binding.template.expression.resolve(binding.context)
  ) {
    binding.update = textInputUpdate;
  }
}

function textInputUpdate(previous, pass) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.eventmodel" id="apidoc.module.derby.eventmodel">module derby.eventmodel</a></h1>


    <h2>
        <a href="#apidoc.element.derby.eventmodel.eventmodel" id="apidoc.element.derby.eventmodel.eventmodel">
        function <span class="apidocSignatureSpan">derby.</span>eventmodel
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventModel() {
  this.id = nextId++;

  // Most of these won&#x27;t ever be filled in, so I&#x27;m just leaving them null.
  //
  // These contain our EventModel children.
  this.object = null;
  this.array = null;

  // This contains any EventModel children which have floating references.
  this.arrayByReference = null;

  // If the data stored here is ever used to lookup other values, this is an
  // object mapping remote child ID -&#x3e; ref.
  //
  // Eg given x[y], y.refOut[x.id] = &#x3c;Binding&#x3e;
  this.refOut = null;

  // This is a map from ref id -&#x3e; event model for events bound to this
  // EventModel but via a ref. We could just merge them into the main tree, but
  // this way they&#x27;re easy to move.
  //
  // Eg, given x[y] (y=1), x.1.refChildren[ref id] is an EventModel.
  this.refChildren = null;

  this.bindings = null;

  // Item contexts are contexts which need their item number changed as this
  // EventModel object moves around its surrounding list.
  this.itemContexts = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.eventmodel.prototype" id="apidoc.module.derby.eventmodel.prototype">module derby.eventmodel.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype._addBinding" id="apidoc.element.derby.eventmodel.prototype._addBinding">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_addBinding
        <span class="apidocSignatureSpan">(binding)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_addBinding = function (binding) {
  var bindings = this.bindings || (this.bindings = new BindingsMap());
  binding.eventModels || (binding.eventModels = new EventModelsMap());
  bindings[binding.id] = binding;
  binding.eventModels[this.id] = this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  bindings[binding.id] = binding;
  binding.eventModels[this.id] = this;
};

// This is the main hook to add bindings to the event model tree. It should
// only be called on the root EventModel object.
EventModel.prototype.addBinding = function(segments, binding) {
  this.at(segments).<span class="apidocCodeKeywordSpan">_addBinding</span>(binding);
};

// This is used for objects (contexts in derby&#x27;s case) that have a .item
// property which refers to an array index.
EventModel.prototype.addItemContext = function(segments, context) {
  this.at(segments)._addItemContext(context);
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype._addItemContext" id="apidoc.element.derby.eventmodel.prototype._addItemContext">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_addItemContext
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_addItemContext = function (context) {
  if (!context._id) context._id = nextId++;
  if (!this.itemContexts) this.itemContexts = new ItemContextsMap();
  this.itemContexts[context._id] = context;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
EventModel.prototype.addBinding = function(segments, binding) {
this.at(segments)._addBinding(binding);
};

// This is used for objects (contexts in derby&#x27;s case) that have a .item
// property which refers to an array index.
EventModel.prototype.addItemContext = function(segments, context) {
this.at(segments).<span class="apidocCodeKeywordSpan">_addItemContext</span>(context);
};

EventModel.prototype.removeBinding = function(binding) {
if (!binding.eventModels) return;
for (var id in binding.eventModels) {
  var eventModel = binding.eventModels[id];
  if (eventModel.bindings) delete eventModel.bindings[binding.id];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype._each" id="apidoc.element.derby.eventmodel.prototype._each">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_each
        <span class="apidocSignatureSpan">(segments, pos, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_each = function (segments, pos, fn) {
  // Our refChildren are effectively merged into this object.
  if (this.refChildren) {
    for (var id in this.refChildren) {
      var refChild = this.refChildren[id];
      if (refChild) refChild._each(segments, pos, fn);
    }
  }

  if (segments.length === pos) {
    fn(this);
    return;
  }

  var segment = segments[pos];
  var child;
  if (typeof segment === &#x27;string&#x27;) {
    // Object. Just recurse into our objects set. Its possible to rewrite this
    // function to simply loop in the case of object lookups, but I don&#x27;t think
    // it&#x27;ll buy us much.
    child = this.object &#x26;&#x26; this.object[segment];
    if (child) child._each(segments, pos + 1, fn);

  } else {
    // Number. Recurse both into the fixed list and the reference list.
    child = this.array &#x26;&#x26; this.array[segment];
    if (child) child._each(segments, pos + 1, fn);

    child = this.arrayByReference &#x26;&#x26; this.arrayByReference[segment];
    if (child) child._each(segments, pos + 1, fn);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

EventModel.prototype._each = function(segments, pos, fn) {
// Our refChildren are effectively merged into this object.
if (this.refChildren) {
  for (var id in this.refChildren) {
    var refChild = this.refChildren[id];
    if (refChild) refChild.<span class="apidocCodeKeywordSpan">_each</span>(segments, pos, fn);
  }
}

if (segments.length === pos) {
  fn(this);
  return;
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype._insert" id="apidoc.element.derby.eventmodel.prototype._insert">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_insert
        <span class="apidocSignatureSpan">(index, howMany)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_insert = function (index, howMany) {
  // Update fixed paths
  this._updateArray(index);

  // Update relative paths
  if (this.arrayByReference &#x26;&#x26; this.arrayByReference.length &#x3e; index) {
    // Shift the actual items in the array references array.

    // This probably isn&#x27;t the best way to implement insert. Other options are
    // using concat() on slices or though constructing a temporary array and
    // using splice.call. Hopefully if this method is slow it&#x27;ll come up during
    // profiling.
    for (var i = 0; i &#x3c; howMany; i++) {
      this.arrayByReference.splice(index, 0, null);
    }

    // Update the path in the contexts
    this._updateChildItemContexts(index + howMany);
  }

  // Finally call our bindings.
  if (this.bindings) {
    for (var id in this.bindings) {
      var binding = this.bindings[id];
      if (binding) binding.insert(index, howMany);
    }
  }
  this._updateObject();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.mutate(segments, function childSet(child) {
  child._set(previous, pass);
});
};

EventModel.prototype.insert = function(segments, index, howMany) {
this.mutate(segments, function childInsert(child) {
  child.<span class="apidocCodeKeywordSpan">_insert</span>(index, howMany);
});
};

EventModel.prototype.remove = function(segments, index, howMany) {
this.mutate(segments, function childRemove(child) {
  child._remove(index, howMany);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype._move" id="apidoc.element.derby.eventmodel.prototype._move">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_move
        <span class="apidocSignatureSpan">(from, to, howMany)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_move = function (from, to, howMany) {
  // first points to the first element that was moved. end points to the list
  // element past the end of the changed region.
  var first, end;
  if (from &#x3c; to) {
    first = from;
    end = to + howMany;
  } else {
    first = to;
    end = from + howMany;
  }

  // Update fixed paths.
  this._updateArray(first, end);

  // Update relative paths
  var arr = this.arrayByReference;
  if (arr &#x26;&#x26; arr.length &#x3e; first) {
    // Remove from the old location
    var values = arr.splice(from, howMany);

    // Insert at the new location
    arr.splice.apply(arr, [to, 0].concat(values));

    // Update the path in the contexts
    this._updateChildItemContexts(first, end);
  }

  // Finally call our bindings.
  if (this.bindings) {
    for (var id in this.bindings) {
      var binding = this.bindings[id];
      if (binding) binding.move(from, to, howMany);
    }
  }
  this._updateObject();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.mutate(segments, function childRemove(child) {
    child._remove(index, howMany);
  });
};

EventModel.prototype.move = function(segments, from, to, howMany) {
  this.mutate(segments, function childMove(child) {
    child.<span class="apidocCodeKeywordSpan">_move</span>(from, to, howMany);
  });
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype._remove" id="apidoc.element.derby.eventmodel.prototype._remove">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_remove
        <span class="apidocSignatureSpan">(index, howMany)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_remove = function (index, howMany) {
  // Update fixed paths. Both the removed items and items after it may have changed.
  this._updateArray(index);

  if (this.arrayByReference) {
    // Update relative paths. First throw away all the children which have been removed.
    this.arrayByReference.splice(index, howMany);

    this._updateChildItemContexts(index);
  }

  // Call bindings.
  if (this.bindings) {
    for (var id in this.bindings) {
      var binding = this.bindings[id];
      if (binding) binding.remove(index, howMany);
    }
  }
  this._updateObject();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.mutate(segments, function childInsert(child) {
  child._insert(index, howMany);
});
};

EventModel.prototype.remove = function(segments, index, howMany) {
this.mutate(segments, function childRemove(child) {
  child.<span class="apidocCodeKeywordSpan">_remove</span>(index, howMany);
});
};

EventModel.prototype.move = function(segments, from, to, howMany) {
this.mutate(segments, function childMove(child) {
  child._move(from, to, howMany);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype._removeItemContext" id="apidoc.element.derby.eventmodel.prototype._removeItemContext">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_removeItemContext
        <span class="apidocSignatureSpan">(context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_removeItemContext = function (context) {
  if (this.itemContexts) {
    delete this.itemContexts[context._id];
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype._set" id="apidoc.element.derby.eventmodel.prototype._set">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_set
        <span class="apidocSignatureSpan">(previous, pass)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_set = function (previous, pass) {
  // This just updates anything thats bound to the whole subtree. An alternate
  // implementation could be passed in the new value at this node (which we
  // cache), then compare with the old version and only update parts of the
  // subtree which are relevant. I don&#x27;t know if thats an important
  // optimization - it really depends on your use case.
  this.update(previous, pass);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var wildcardSegments = segments.slice(0, i);
    wildcardSegments.push(&#x27;*&#x27;);
    this._each(wildcardSegments, 0, childSetWildcard);
  }
};

function childSetWildcard(child) {
  child.<span class="apidocCodeKeywordSpan">_set</span>();
}

EventModel.prototype.set = function(segments, previous, pass) {
  this.mutate(segments, function childSet(child) {
    child._set(previous, pass);
  });
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype._updateArray" id="apidoc.element.derby.eventmodel.prototype._updateArray">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_updateArray
        <span class="apidocSignatureSpan">(from, to)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_updateArray = function (from, to) {
  if (!this.array) return;

  if (from == null) from = 0;
  if (to == null) to = this.array.length;

  for (var i = from; i &#x3c; to; i++) {
    var binding = this.array[i];
    if (binding) binding.update();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // optimization - it really depends on your use case.
  this.update(previous, pass);
};

// Insert into this EventModel node.
EventModel.prototype._insert = function(index, howMany) {
  // Update fixed paths
  this.<span class="apidocCodeKeywordSpan">_updateArray</span>(index);

  // Update relative paths
  if (this.arrayByReference &#x26;&#x26; this.arrayByReference.length &#x3e; index) {
// Shift the actual items in the array references array.

// This probably isn&#x27;t the best way to implement insert. Other options are
// using concat() on slices or though constructing a temporary array and
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype._updateChildItemContexts" id="apidoc.element.derby.eventmodel.prototype._updateChildItemContexts">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_updateChildItemContexts
        <span class="apidocSignatureSpan">(from, to)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_updateChildItemContexts = function (from, to) {
  if (!this.arrayByReference) return;

  if (from == null) from = 0;
  if (to == null) to = this.arrayByReference.length;

  for (var i = from; i &#x3c; to; i++) {
    var contexts = this.arrayByReference[i] &#x26;&#x26;
      this.arrayByReference[i].itemContexts;
    if (contexts) {
      for (var key in contexts) {
        contexts[key].item = i;
      }
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // using splice.call. Hopefully if this method is slow it&#x27;ll come up during
  // profiling.
  for (var i = 0; i &#x3c; howMany; i++) {
    this.arrayByReference.splice(index, 0, null);
  }

  // Update the path in the contexts
  this.<span class="apidocCodeKeywordSpan">_updateChildItemContexts</span>(index + howMany);
}

// Finally call our bindings.
if (this.bindings) {
  for (var id in this.bindings) {
    var binding = this.bindings[id];
    if (binding) binding.insert(index, howMany);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype._updateObject" id="apidoc.element.derby.eventmodel.prototype._updateObject">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>_updateObject
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_updateObject = function () {
  if (this.object) {
    for (var key in this.object) {
      var binding = this.object[key];
      if (binding) binding.update();
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// Finally call our bindings.
if (this.bindings) {
  for (var id in this.bindings) {
    var binding = this.bindings[id];
    if (binding) binding.insert(index, howMany);
  }
}
this.<span class="apidocCodeKeywordSpan">_updateObject</span>();
};

// Remove howMany child elements from this EventModel at index.
EventModel.prototype._remove = function(index, howMany) {
// Update fixed paths. Both the removed items and items after it may have changed.
this._updateArray(index);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.addBinding" id="apidoc.element.derby.eventmodel.prototype.addBinding">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>addBinding
        <span class="apidocSignatureSpan">(segments, binding)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addBinding = function (segments, binding) {
  this.at(segments)._addBinding(binding);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    this.eventModel.removeBinding(this);
  }
  // Add new dependencies
  if (!dependencies) return;
  this.dependencies = dependencies;
  for (var i = 0, len = dependencies.length; i &#x3c; len; i++) {
    var dependency = dependencies[i];
    if (dependency) this.eventModel.<span class="apidocCodeKeywordSpan">addBinding</span>(dependency, this);
  }
};
BindingWrapper.prototype.update = function(previous, pass) {
  this.binding.update(previous, pass);
  this.updateDependencies();
};
BindingWrapper.prototype.insert = function(index, howMany) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.addItemContext" id="apidoc.element.derby.eventmodel.prototype.addItemContext">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>addItemContext
        <span class="apidocSignatureSpan">(segments, context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addItemContext = function (segments, context) {
  this.at(segments)._addItemContext(context);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.context.meta.removeBinding = removeBinding;
this.context.meta.removeNode = removeNode;
this.context.meta.addItemContext = addItemContext;
this.context.meta.removeItemContext = removeItemContext;

function addItemContext(context) {
  var segments = context.expression.resolve(context);
  eventModel.<span class="apidocCodeKeywordSpan">addItemContext</span>(segments, context);
}
function removeItemContext(context) {
  // TODO
}
function addBinding(binding) {
  patchTextBinding(binding);
  var expressions = binding.template.expressions;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.arrayLookup" id="apidoc.element.derby.eventmodel.prototype.arrayLookup">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>arrayLookup
        <span class="apidocSignatureSpan">(model, segmentsBefore, segmentsInside)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">arrayLookup = function (model, segmentsBefore, segmentsInside) {
  var segments = expressions.pathSegments(segmentsInside);
  var item = expressions.lookup(segments, model.data);

  var source = this.at(segmentsInside);

  // What the array currently resolves to. Given x[y] with y=1, container is
  // the EM for x
  var container = this.at(segmentsBefore);

  if (!source.refOut) source.refOut = new RefOutMap();

  var ref = source.refOut[container.id];
  if (ref == null) {
    ref = new ModelRef(model, item, segmentsInside, container);
    source.refOut[container.id] = ref;
  }

  return ref;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.at" id="apidoc.element.derby.eventmodel.prototype.at">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>at
        <span class="apidocSignatureSpan">(segments)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">at = function (segments) {
  // For unbound dependancies.
  if (segments == null) return this;

  var eventModel = this;

  for (var i = 0; i &#x3c; segments.length; i++) {
    eventModel = eventModel.child(segments[i]);
  }

  return eventModel;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
return this.refChildren[id];
};

EventModel.prototype.arrayLookup = function(model, segmentsBefore, segmentsInside) {
var segments = expressions.pathSegments(segmentsInside);
var item = expressions.lookup(segments, model.data);

var source = this.<span class="apidocCodeKeywordSpan">at</span>(segmentsInside);

// What the array currently resolves to. Given x[y] with y=1, container is
// the EM for x
var container = this.at(segmentsBefore);

if (!source.refOut) source.refOut = new RefOutMap();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.child" id="apidoc.element.derby.eventmodel.prototype.child">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>child
        <span class="apidocSignatureSpan">(segment)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">child = function (segment) {
  var container;
  if (typeof segment === &#x27;string&#x27;) {
    // Object
    if (!this.object) this.object = {};
    container = this.object;

  } else if (typeof segment === &#x27;number&#x27;) {
    // Array by value
    if (!this.array) this.array = [];
    container = this.array;

  } else if (segment instanceof ModelRef) {
    // Array reference. We&#x27;ll need to lookup the child with the right
    // value, then look inside its ref children for the right EventModel
    // (so we can update it later). This is pretty janky, but should be
    // *correct* even in the face of recursive array accessors.
    //
    // This will calculate it based on the current segment values, but refs
    // cache the EM anyway.
    //return this.child(segment.item).refChild(segment);
    return segment.result;

  } else {
    // Array by reference
    if (!this.arrayByReference) this.arrayByReference = [];
    container = this.arrayByReference;
    segment = segment.item;
  }

  return container[segment] || (container[segment] = new EventModel());
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// outside is a reference to the EventModel of the thing on the lhs of the
// brackets. For example, in x[y].z, outside is the EventModel of x.
this.outside = outside;

// result is the EventModel of the evaluated version of the brackets. In
// x[y].z, its the EventModel of x[y].
this.result = outside.<span class="apidocCodeKeywordSpan">child</span>(item).refChild(this);
}

ModelRef.prototype.update = function() {
var segments = expressions.pathSegments(this.segments);
var newItem = expressions.lookup(segments, this.model.data);
if (this.item === newItem) return;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.insert" id="apidoc.element.derby.eventmodel.prototype.insert">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>insert
        <span class="apidocSignatureSpan">(segments, index, howMany)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">insert = function (segments, index, howMany) {
  this.mutate(segments, function childInsert(child) {
    child._insert(index, howMany);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});
var unloadListener = model.on(&#x27;unload&#x27;, &#x27;**&#x27;, function onUnload(path) {
  var segments = util.castSegments(path.split(&#x27;.&#x27;));
  eventModel.set(segments);
});
var insertListener = model.on(&#x27;insert&#x27;, &#x27;**&#x27;, function onInsert(path, index, values) {
  var segments = util.castSegments(path.split(&#x27;.&#x27;));
  eventModel.<span class="apidocCodeKeywordSpan">insert</span>(segments, index, values.length);
});
var removeListener = model.on(&#x27;remove&#x27;, &#x27;**&#x27;, function onRemove(path, index, values) {
  var segments = util.castSegments(path.split(&#x27;.&#x27;));
  eventModel.remove(segments, index, values.length);
});
var moveListener = model.on(&#x27;move&#x27;, &#x27;**&#x27;, function onMove(path, from, to, howMany) {
  var segments = util.castSegments(path.split(&#x27;.&#x27;));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.isEmpty" id="apidoc.element.derby.eventmodel.prototype.isEmpty">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>isEmpty
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">isEmpty = function () {
  if (hasKeys(this.dependancies)) return false;
  if (hasKeys(this.itemContexts)) return false;

  if (this.object) {
    if (hasKeys(this.object)) return false;
    this.object = null;
  }

  if (this.arrayByReference) {
    for (var i = 0; i &#x3c; this.arrayByReference.length; i++) {
      if (this.arrayByReference[i] != null) return false;
    }
    this.arrayByReference = null;
  }

  if (this.array) {
    for (var i = 0; i &#x3c; this.array.length; i++) {
      if (this.array[i] != null) return false;
    }
    this.array = null;
  }

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.localUpdate" id="apidoc.element.derby.eventmodel.prototype.localUpdate">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>localUpdate
        <span class="apidocSignatureSpan">(previous, pass)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">localUpdate = function (previous, pass) {
  if (this.bindings) {
    for (var id in this.bindings) {
      var binding = this.bindings[id];
      if (binding) binding.update(previous, pass);
    }
  }

  // If our value changed, we also need to update anything that depends on it
  // via refOut.
  if (this.refOut) {
    for (var id in this.refOut) {
      var ref = this.refOut[id];
      if (ref) ref.update();
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (ref) ref.update();
  }
}
};

// This is used when an object subtree is replaced / removed.
EventModel.prototype.update = function(previous, pass) {
this.<span class="apidocCodeKeywordSpan">localUpdate</span>(previous, pass);

if (this.object) {
  for (var key in this.object) {
    var binding = this.object[key];
    if (binding) binding.update();
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.move" id="apidoc.element.derby.eventmodel.prototype.move">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>move
        <span class="apidocSignatureSpan">(segments, from, to, howMany)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">move = function (segments, from, to, howMany) {
  this.mutate(segments, function childMove(child) {
    child._move(from, to, howMany);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});
var removeListener = model.on(&#x27;remove&#x27;, &#x27;**&#x27;, function onRemove(path, index, values) {
  var segments = util.castSegments(path.split(&#x27;.&#x27;));
  eventModel.remove(segments, index, values.length);
});
var moveListener = model.on(&#x27;move&#x27;, &#x27;**&#x27;, function onMove(path, from, to, howMany) {
  var segments = util.castSegments(path.split(&#x27;.&#x27;));
  eventModel.<span class="apidocCodeKeywordSpan">move</span>(segments, from, to, howMany);
});

this._removeModelListeners = function() {
  model.removeListener(&#x27;change&#x27;, changeListener);
  model.removeListener(&#x27;load&#x27;, loadListener);
  model.removeListener(&#x27;unload&#x27;, unloadListener);
  model.removeListener(&#x27;insert&#x27;, insertListener);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.mutate" id="apidoc.element.derby.eventmodel.prototype.mutate">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>mutate
        <span class="apidocSignatureSpan">(segments, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">mutate = function (segments, fn) {
  // This finds &#x26; returns a list of all event models which exist and could match
  // the specified path. The path cannot contain contexts like derby expression
  // segment lists (just because I don&#x27;t think thats a useful feature and its not
  // implemented)
  this._each(segments, 0, fn);

  // Also emit all mutations as sets on star paths, which are how dependencies
  // for view helper functions are represented. They should react to a path
  // or any child path being modified
  for (var i = 0, len = segments.length; i++ &#x3c; len;) {
    var wildcardSegments = segments.slice(0, i);
    wildcardSegments.push(&#x27;*&#x27;);
    this._each(wildcardSegments, 0, childSetWildcard);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

function childSetWildcard(child) {
child._set();
}

EventModel.prototype.set = function(segments, previous, pass) {
this.<span class="apidocCodeKeywordSpan">mutate</span>(segments, function childSet(child) {
  child._set(previous, pass);
});
};

EventModel.prototype.insert = function(segments, index, howMany) {
this.mutate(segments, function childInsert(child) {
  child._insert(index, howMany);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.refChild" id="apidoc.element.derby.eventmodel.prototype.refChild">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>refChild
        <span class="apidocSignatureSpan">(ref)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">refChild = function (ref) {
  if (!this.refChildren) this.refChildren = new RefChildrenMap();
  var id = ref.id;

  if (!this.refChildren[id]) {
    this.refChildren[id] = new EventModel();
  }
  return this.refChildren[id];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// outside is a reference to the EventModel of the thing on the lhs of the
// brackets. For example, in x[y].z, outside is the EventModel of x.
this.outside = outside;

// result is the EventModel of the evaluated version of the brackets. In
// x[y].z, its the EventModel of x[y].
this.result = outside.child(item).<span class="apidocCodeKeywordSpan">refChild</span>(this);
}

ModelRef.prototype.update = function() {
var segments = expressions.pathSegments(this.segments);
var newItem = expressions.lookup(segments, this.model.data);
if (this.item === newItem) return;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.remove" id="apidoc.element.derby.eventmodel.prototype.remove">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>remove
        <span class="apidocSignatureSpan">(segments, index, howMany)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">remove = function (segments, index, howMany) {
  this.mutate(segments, function childRemove(child) {
    child._remove(index, howMany);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Dom.prototype._initListeners = function() {
  var dom = this;
  this.controller.on(&#x27;destroy&#x27;, function domOnDestroy() {
    var listeners = dom._listeners;
    if (!listeners) return;
    for (var i = listeners.length; i--;) {
      listeners[i].<span class="apidocCodeKeywordSpan">remove</span>();
    }
    dom._listeners = null;
  });
  return this._listeners = [];
};

Dom.prototype._listenerIndex = function(domListener) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.removeBinding" id="apidoc.element.derby.eventmodel.prototype.removeBinding">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>removeBinding
        <span class="apidocSignatureSpan">(binding)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">removeBinding = function (binding) {
  if (!binding.eventModels) return;
  for (var id in binding.eventModels) {
    var eventModel = binding.eventModels[id];
    if (eventModel.bindings) delete eventModel.bindings[binding.id];
  }
  binding.eventModels = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    addDependencies(eventModel, expression, binding);
  }
}
function removeBinding(binding) {
  var bindingWrappers = binding.meta;
  if (!bindingWrappers) return;
  for (var i = bindingWrappers.length; i--;) {
    eventModel.<span class="apidocCodeKeywordSpan">removeBinding</span>(bindingWrappers[i]);
  }
}
function removeNode(node) {
  var component = node.$component;
  if (component &#x26;&#x26; !component.singleton) {
    component.destroy();
  }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.set" id="apidoc.element.derby.eventmodel.prototype.set">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>set
        <span class="apidocSignatureSpan">(segments, previous, pass)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (segments, previous, pass) {
  this.mutate(segments, function childSet(child) {
    child._set(previous, pass);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // Cancel any routing before the initial page attachment. Instead, do a
  // render once derby is ready
  this._cancelAttach = true;
  return;
}
this.emit(&#x27;route&#x27;, page);
// HACK: To update render in transitional routes
page.model.<span class="apidocCodeKeywordSpan">set</span>(&#x27;$render.params&#x27;, page.params);
page.model.set(&#x27;$render.url&#x27;, page.params.url);
page.model.set(&#x27;$render.query&#x27;, page.params.query);
// If transitional
if (done) {
  var app = this;
  var _done = function() {
    app.emit(&#x27;routeDone&#x27;, page, &#x27;transition&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.eventmodel.prototype.update" id="apidoc.element.derby.eventmodel.prototype.update">
        function <span class="apidocSignatureSpan">derby.eventmodel.prototype.</span>update
        <span class="apidocSignatureSpan">(previous, pass)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">update = function (previous, pass) {
  this.localUpdate(previous, pass);

  if (this.object) {
    for (var key in this.object) {
      var binding = this.object[key];
      if (binding) binding.update();
    }
  }

  if (this.array) {
    for (var i = 0; i &#x3c; this.array.length; i++) {
      var binding = this.array[i];
      if (binding) binding.update();
    }
  }

  if (this.arrayByReference) {
    for (var i = 0; i &#x3c; this.arrayByReference.length; i++) {
      var binding = this.arrayByReference[i];
      if (binding) binding.update();
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  bundle.on(&#x27;file&#x27;, function(filename) {
    bundleFiles.push(filename);
  });
  app.emit(&#x27;bundle&#x27;, bundle);
});
backend.bundle(app.filename, options, function(err, source, map) {
  if (err) return cb(err);
  app.scriptHash = crypto.createHash(&#x27;md5&#x27;).<span class="apidocCodeKeywordSpan">update</span>(source).digest(&#x27;hex
&#x27;);
  source = source.replace(&#x27;{{DERBY_SCRIPT_HASH}}&#x27;, app.scriptHash);
  source = source.replace(/[&#x27;&#x22;]{{DERBY_BUNDLED_AT}}[&#x27;&#x22;]/, Date.now());
  if (!util.isProduction) {
    app._autoRefresh(backend);
    app._watchBundle(bundleFiles);
  }
  cb(null, source, map);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.files" id="apidoc.module.derby.files">module derby.files</a></h1>


    <h2>
        <a href="#apidoc.element.derby.files.cssCompiler" id="apidoc.element.derby.files.cssCompiler">
        function <span class="apidocSignatureSpan">derby.files.</span>cssCompiler
        <span class="apidocSignatureSpan">(file, filename, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function cssCompiler(file, filename, options) {
  return {css: file, files: [filename]};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.files.htmlCompiler" id="apidoc.element.derby.files.htmlCompiler">
        function <span class="apidocSignatureSpan">derby.files.</span>htmlCompiler
        <span class="apidocSignatureSpan">(file, filename)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function htmlCompiler(file, filename) {
  return file;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.files.loadStylesSync" id="apidoc.element.derby.files.loadStylesSync">
        function <span class="apidocSignatureSpan">derby.files.</span>loadStylesSync
        <span class="apidocSignatureSpan">(app, sourceFilename, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function loadStylesSync(app, sourceFilename, options) {
  options || (options = {compress: util.isProduction});
  var resolved = resolve.sync(sourceFilename, {extensions: app.styleExtensions, packageFilter: deleteMain});
  if (!resolved) {
    throw new Error(&#x27;Style file not found: &#x27; + sourceFilename);
  }
  var extension = path.extname(resolved);
  var compiler = app.compilers[extension];
  if (!compiler) {
    throw new Error(&#x27;Unable to find compiler for: &#x27; + extension);
  }
  var file = fs.readFileSync(resolved, &#x27;utf8&#x27;);
  return compiler(file, resolved, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var stylesView = this.views.find(&#x27;Styles&#x27;);
stylesView.source += &#x27;&#x3c;view is=&#x22;&#x27; + filename + &#x27;&#x22;&#x3e;&#x3c;/view&#x3e;&#x27;;
// Make chainable
return this;
};

App.prototype._loadStyles = function(filename, options) {
var styles = files.<span class="apidocCodeKeywordSpan">loadStylesSync</span>(this, filename, options);

var filepath = &#x27;&#x27;;
if (!util.isProduction) {
  /**
   * Mark the path to file as an attribute
   * Used in development to add event watchers and autorefreshing of styles
   * SEE: local file, method this._watchStyles
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.files.loadViewsSync" id="apidoc.element.derby.files.loadViewsSync">
        function <span class="apidocSignatureSpan">derby.files.</span>loadViewsSync
        <span class="apidocSignatureSpan">(app, sourceFilename, namespace)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function loadViewsSync(app, sourceFilename, namespace) {
  var views = [];
  var files = [];
  var resolved = resolve.sync(sourceFilename, {extensions: app.viewExtensions, packageFilter: deleteMain});
  if (!resolved) {
    throw new Error(&#x27;View template file not found: &#x27; + sourceFilename);
  }

  var file = fs.readFileSync(resolved, &#x27;utf8&#x27;);

  var extension = path.extname(resolved);
  var compiler = app.compilers[extension];
  if (!compiler) {
    throw new Error(&#x27;Unable to find compiler for: &#x27; + extension);
  }

  var htmlFile = compiler(file, resolved);

  var parsed = parseViews(namespace, htmlFile, resolved, app.viewExtensions);
  for (var i = 0, len = parsed.imports.length; i &#x3c; len; i++) {
    var item = parsed.imports[i];
    var imported = loadViewsSync(app, item.filename, item.namespace);
    views = views.concat(imported.views);
    files = files.concat(imported.files);
  }
  return {
    views: views.concat(parsed.views)
  , files: files.concat(resolved)
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var serialized = require(this.serializedBase + &#x27;.json&#x27;);
serializedViews(derbyTemplates, this.views);
this.scriptUrl = (this.scriptBaseUrl || serialized.scriptBaseUrl) + serialized.scriptUrl;
this.scriptMapUrl = (this.scriptMapBaseUrl || serialized.scriptMapBaseUrl) + serialized.scriptMapUrl;
};

App.prototype.loadViews = function(filename, namespace) {
var data = files.<span class="apidocCodeKeywordSpan">loadViewsSync</span>(this, filename, namespace);
for (var i = 0, len = data.views.length; i &#x3c; len; i++) {
  var item = data.views[i];
  this.views.register(item.name, item.source, item.options);
}
if (!util.isProduction) this._watchViews(data.files, filename, namespace);
// Make chainable
return this;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.derby.textDiff" id="apidoc.module.derby.textDiff">module derby.textDiff</a></h1>


    <h2>
        <a href="#apidoc.element.derby.textDiff.onStringInsert" id="apidoc.element.derby.textDiff.onStringInsert">
        function <span class="apidocSignatureSpan">derby.textDiff.</span>onStringInsert
        <span class="apidocSignatureSpan">(el, previous, index, text)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function onStringInsert(el, previous, index, text) {
  function transformCursor(cursor) {
    return (index &#x3c; cursor) ? cursor + text.length : cursor;
  }
  previous || (previous = &#x27;&#x27;);
  var newText = previous.slice(0, index) + text + previous.slice(index);
  replaceText(el, newText, transformCursor);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
textUpdate(this, this.element, previous, pass);
}
function textUpdate(binding, element, previous, pass) {
if (pass) {
  if (pass.$event &#x26;&#x26; pass.$event.target === element) {
    return;
  } else if (pass.$stringInsert) {
    return textDiff.<span class="apidocCodeKeywordSpan">onStringInsert</span>(
      element,
      previous,
      pass.$stringInsert.index,
      pass.$stringInsert.text
    );
  } else if (pass.$stringRemove) {
    return textDiff.onStringRemove(
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.textDiff.onStringRemove" id="apidoc.element.derby.textDiff.onStringRemove">
        function <span class="apidocSignatureSpan">derby.textDiff.</span>onStringRemove
        <span class="apidocSignatureSpan">(el, previous, index, howMany)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function onStringRemove(el, previous, index, howMany) {
  function transformCursor(cursor) {
    return (index &#x3c; cursor) ? cursor - Math.min(howMany, cursor - index) : cursor;
  }
  previous || (previous = &#x27;&#x27;);
  var newText = previous.slice(0, index) + previous.slice(index + howMany);
  replaceText(el, newText, transformCursor);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return textDiff.onStringInsert(
      element,
      previous,
      pass.$stringInsert.index,
      pass.$stringInsert.text
    );
  } else if (pass.$stringRemove) {
    return textDiff.<span class="apidocCodeKeywordSpan">onStringRemove</span>(
      element,
      previous,
      pass.$stringRemove.index,
      pass.$stringRemove.howMany
    );
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.derby.textDiff.onTextInput" id="apidoc.element.derby.textDiff.onTextInput">
        function <span class="apidocSignatureSpan">derby.textDiff.</span>onTextInput
        <span class="apidocSignatureSpan">(model, segments, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function onTextInput(model, segments, value) {
  var previous = model._get(segments) || &#x27;&#x27;;
  if (previous === value) return;
  var start = 0;
  while (previous.charAt(start) === value.charAt(start)) {
    start++;
  }
  var end = 0;
  while (
    previous.charAt(previous.length - 1 - end) === value.charAt(value.length - 1 - end) &#x26;&#x26;
    end + start &#x3c; previous.length &#x26;&#x26;
    end + start &#x3c; value.length
  ) {
    end++;
  }

  if (previous.length !== start + end) {
    var howMany = previous.length - start - end;
    model._stringRemove(segments, start, howMany);
  }
  if (value.length !== start + end) {
    var inserted = value.slice(start, value.length - end);
    model._stringInsert(segments, start, inserted);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

function textDiffBinding(binding, value, pass) {
var expression = binding.template.expression;
var segments = expression.pathSegments(binding.context);
if (segments) {
  var model = binding.context.controller.model.pass(pass);
  textDiff.<span class="apidocCodeKeywordSpan">onTextInput</span>(model, segments, value);
} else if (expression.set) {
  expression.set(binding.context, value);
}
}

function setOptionBindings(parent) {
for (var node = parent.firstChild; node; node = node.nextSibling) {
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
